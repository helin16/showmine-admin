!function(){"use strict";var e,t,n=function(e,t){return{request:function(n){return n.headers["default-lang"]=t.localStorage.getItem("language"),n||e.when(n)},response:function(e){return e},responseError:function(t){return e.reject(t)}}},a=function(e){e.tokenType="X-Auth-Token",e.storageType="localStorage"},i=function(e,n){t.$on("$stateChangeStart",function(t,a,i,o,r){!0!==a.needsAuth||n.isAuthenticated()||(e.transitionTo("login"),t.preventDefault())}),t.$on("$stateChangeSuccess",function(e,n,a,i,o){t.previousState={state:i,params:o},document.body.scrollTop=document.documentElement.scrollTop=0})},o=function(n,a,o,r,s,c){return t=n,e=this,t.appConf=r,t.apiRegion&&""!==t.apiRegion?r.userRegion.setAPIRegion(t.apiRegion):c.getUserRegion().then(function(e){e.data&&e.data.country&&"china"===e.data.country.toLowerCase()?t.apiRegion=e.data.country.toLowerCase():t.apiRegion="default",r.userRegion.setAPIRegion(t.apiRegion)},function(e){}).finally(function(){}),s.changeLocale(t.appConf.default.momentJs.locale),i(a,o),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),e};angular.module("shmApp.config",[]),angular.module("shmApp.controllers",[]),angular.module("shmApp.services",[]),angular.module("shmApp.directives",[]),angular.module("shmApp.filters",[]),angular.module("shmApp.languages",[]),angular.module("shmApp.routes",[]),angular.module("shmApp.templates",[]),e=angular.module("shmApp",["oc.lazyLoad","angular-ladda","angular.filter","satellizer","ui.bootstrap","ngSanitize","angularMoment","ngFileUpload","ui.tinymce","ui.bootstrap.datetimepicker","ui.dateTimeInput","toastr","ngFileUpload","ngTagsInput","shmApp.config","shmApp.services","shmApp.controllers","shmApp.directives","shmApp.filters","shmApp.languages","shmApp.routes","shmApp.templates"]).factory("myInterceptor",["$q","$window",n]).config(["$authProvider",a]).config(["$httpProvider",function(e){e.interceptors.push("myInterceptor")}]).config(["toastrConfig",function(e){angular.extend(e,{allowHtml:!0,closeButton:!0,closeHtml:'<button type="button">&times;</a>'})}]).run(["$rootScope","$state","AuthService","appConf","amMoment","UtilsService",o])}(),function(){"use strict";var e,t,n,a,i,o,r=function(e){e.displayCounts="",e.detailsTitle="",e.appUser=void 0},s=function(){return a.otherwise("/"),n.state("login",{url:"/",template:'<div class="login-page"><login-panel app-user="appUser" class="login-panel"></login-panel></div>'}).state("signup",{url:"/signup",template:'<div class="sign-up-page-wrapper"><sign-up-panel app-user="appUser" class="sign-up-page"></sign-up-panel></div>'}).state("auth",{abstract:!0,url:"/a",templateUrl:t+"auth/auth.html"}).state("auth.getUserFromToken",{url:"/tk?token&origurl",parent:"auth",template:"<login-from-token></login-from-token>"}).state("backend",{abstract:!0,needsAuth:!0,url:"/b",templateUrl:t+"backend/backend.html",resolve:{appUser:["AuthService","$rootScope","$state","UtilsService",function(e,t,n,a){return r(t),t.gettingCurrentUser=!0,t.gettingCurrentUserErr=void 0,e.getMe().then(function(e){if(e.data&&e.data.id){t.appUser=e.data;var i=a.getSelectedCompany();i&&i.id||(i=t.appUser.userCompany[0]),a.setSelectedCompany(i)}else n.go("login")},function(e){401===e.status&&n.go("login"),t.gettingCurrentUserErr=void 0}).finally(function(){t.gettingCurrentUser=!1})}]}}).state("backend.dashboard",{url:"/dashboard",data:{pageTitle:"{{'DASHBOARD' | translate}}"},template:'<dashboard app-user="appUser" company="selectedCompany"></dashboard>'}).state("backend.notes",{url:"/notes",data:{pageTitle:"{{'NOTES' | translate}}",btn:'<button class="btn btn-success" title="{{\'NOTE.NEW_BTN\' | translate}}" ui-sref="backend.notes_new" ui-sref-opts="{reload: true}"><i class="fa fa-plus"></i> <span translate="NOTE.NEW_BTN" class="hidden-xs hidden-sm"></span></button>'},template:'<note-list app-user="appUser" company="selectedCompany"></note-list>'}).state("backend.notes_new",{url:"/notes/new",data:{pageTitle:"{{'NOTE.NEW_BTN' | translate}}",pageSubTitle:['<a translate="NOTES.LIST.TITLE" ui-sref="backend.notes" ui-sref-opts="{reload: true}"></a>','<span translate="NOTE.NEW_BTN"></span>']},template:'<note-details-edit-panel app-user="appUser" company="selectedCompany" cancel-func="goToList"></note-details-edit-panel>',controller:["$scope","$state",function(e,t){e.goToList=function(){t.go("backend.notes",{},{reload:!0})}}]}).state("backend.notes_details",{url:"/notes/:id",data:{pageTitle:"{{'NOTE.EDITING' | translate}}",pageSubTitle:['<a translate="NOTES.LIST.TITLE" ui-sref="backend.notes" ui-sref-opts="{reload: true}"></a>',"<span>{{$root.editingNote.title}}</span>"],btn:'<item-option-btns app-user="appUser" item="$root.editingNote" item-type="{{\'NOTE\' | translate}}" succ-func="$root.reloadItem" ng-if="$root.editingNote.active === 1 && $root.editingNote && $root.editingNote.id && $root.editingNote.id !==\'\'"></item-option-btns>'},template:'<note-details-edit-panel app-user="appUser" company="selectedCompany" cancel-func="goToList" item="item" item-loaded-func="itemLoaded" cancel-func="goToList"></note-details-edit-panel>',controller:["$scope","$stateParams","$rootScope","$state",function(e,t,n,a){e.item={id:t.id},e.itemLoaded=function(e){n.editingNote=e},e.goToList=function(){a.go("backend.notes",{},{reload:!0})},n.reloadItem=function(e){a.reload()}}]}).state("backend.products",{url:"/products",data:{pageTitle:"{{'PRODUCTS' | translate}}",btn:'<button class="btn btn-success" title="{{\'PRODUCTS.NEW_BTN\' | translate}}" ui-sref="backend.products_new" ui-sref-opts="{reload: true}"><i class="fa fa-plus"></i> <span translate="PRODUCTS.NEW_BTN" class="hidden-xs hidden-sm"></span></button>'},template:'<product-list app-user="appUser" company="selectedCompany"></product-list>'}).state("backend.products_new",{url:"/products/new",data:{pageTitle:"{{'PRODUCTS.NEW_BTN' | translate}}",pageSubTitle:['<a translate="PRODUCTS" ui-sref="backend.products" ui-sref-opts="{reload: true}"></a>','<span translate="PRODUCTS.NEW_BTN"></span>']},template:'<product-details app-user="appUser" company="selectedCompany" cancel-func="goToList"></product-details>',controller:["$scope","$state",function(e,t){e.goToList=function(){t.go("backend.products",{},{reload:!0})}}]}).state("backend.product_details",{url:"/products/:id",data:{pageTitle:"{{'PRODUCT.EDITING' | translate}}",pageSubTitle:['<a translate="PRODUCTS" ui-sref="backend.products" ui-sref-opts="{reload: true}"></a>',"<span>{{$root.editingProduct.title}}</span>"],btn:'<item-option-btns app-user="appUser" item="$root.editingProduct" item-type="{{\'PRODUCT\' | translate}}" succ-func="$root.reloadItem"  ng-if="$root.editingProduct.active === 1 && $root.editingProduct && $root.editingProduct.id && $root.editingProduct.id !==\'\'"></item-option-btns>'},template:'<product-details app-user="appUser" company="selectedCompany" item="item" cancel-func="goToList" item-loaded-func="itemLoaded"></product-details>',controller:["$scope","$stateParams","$rootScope","$state",function(e,t,n,a){e.item={id:t.id},e.itemLoaded=function(e){n.editingProduct=e},e.goToList=function(){a.go("backend.products",{},{reload:!0})},n.reloadItem=function(e){a.reload()}}]}).state("backend.group_buys",{url:"/group_buys",data:{menuItem:"group_buys",pageTitle:"{{'GROUP_BUYS' | translate}}",btn:'<button class="btn btn-success" title="{{\'GROUP_BUYS.CREATE.NEW\' | translate}}" ui-sref="backend.group_buys_new" ui-sref-opts="{reload: true}"><i class="fa fa-plus"></i> <span class="hidden-xs hidden-sm">{{\'GROUP_BUYS.CREATE.NEW\'|translate}}</span></button>'},template:'<group-buy-list app-user="appUser" company="selectedCompany"></group-buy-list>'}).state("backend.group_buys_details",{url:"/group_buys/:id",data:{menuItem:"group_buys",pageTitle:"{{'GROUP_BUYS.DESCRIPTION' | translate}}",pageSubTitle:['<a  ui-sref="backend.group_buys" ui-sref-opts="{reload: true}">{{\'GROUP_BUYS.LIST\'|translate}}</a>',"<span>{{$root.editingGroupbuy.title}}</span>",'<a href="javascript: void(0)" item-qr-code-popup-btn="$root.editingGroupbuy" class="qrcode"><i class="fa fa-qrcode"></i></a>']},template:'<not-company-admin-panel ng-if="$root.selectedCompany.isCurrentUserAdmin !== true && appUser.is_admin !== true"></not-company-admin-panel><group-buy-details app-user="appUser" company="selectedCompany" item-id="id" cancel-func="goToList" ng-if="$root.selectedCompany.isCurrentUserAdmin === true || appUser.is_admin === true"></group-buy-details>',controller:["$scope","$stateParams","$state",function(e,t,n){e.id=t.id,e.goToList=function(){n.go("backend.group_buys",{},{reload:!0})}}]}).state("backend.group_buys_new",{url:"/new_group_buys",data:{menuItem:"group_buys",pageTitle:"{{'GROUP_BUYS.CREATE.NEW'| translate}}",pageSubTitle:['<a  ui-sref="backend.group_buys" ui-sref-opts="{reload: true}">{{\'GROUP_BUYS.LIST\'|translate}}</a>']},template:'<not-company-admin-panel ng-if="$root.selectedCompany.isCurrentUserAdmin !== true && appUser.is_admin !== true"></not-company-admin-panel><group-buy-details app-user="appUser" company="selectedCompany" ng-if="$root.selectedCompany.isCurrentUserAdmin === true || appUser.is_admin === true"></group-buy-details>'}).state("backend.vouchers",{url:"/vouchers",data:{pageTitle:"{{'VOUCHERS' | translate}}",pageSubTitle:"<div ng-if=\"$root.displayCounts\">{{'DISPLAY' | translate}}: {{$root.displayCounts}}</div>",btn:'<button class="btn btn-success" title="{{\'NOTE.NEW_BTN\' | translate}}" ui-sref="backend.vouchers_details_new" ui-sref-opts="{reload: true}"><i class="fa fa-plus"></i> <span class="hidden-xs hidden-sm" translate="VOUCHER.NEW.BTN"></span></button>'},template:'<voucher-list app-user="appUser" company="$root.selectedCompany"></voucher-list>'}).state("backend.vouchers_details_new",{url:"/new_vouchers",data:{pageTitle:"{{'VOUCHERS' | translate}}",pageSubTitle:['<a  ui-sref="backend.vouchers" ui-sref-opts="{reload: true}">{{\'VOUCHER_GROUP.LIST\' |translate}}</a>']},template:'<voucher-details app-user="appUser" company="$root.selectedCompany" cancel-func="goToList"></voucher-details>',controller:["$scope","$state",function(e,t){e.goToList=function(){t.go("backend.vouchers",{},{reload:!0})}}]}).state("backend.vouchers_details",{url:"/vouchers/details/:voucherGroupId",data:{pageTitle:"{{'VOUCHERS' | translate}}",pageSubTitle:['<a  ui-sref="backend.vouchers" ui-sref-opts="{reload: true}">{{\'VOUCHER_GROUP.LIST\'|translate}}</a>',"<span>{{$root.editingVoucher.title}}</span>"],btn:'<button class="btn btn-success" voucher-group-qr-code-popup-btn voucher="$root.editingVoucher"><i class="fa fa-qrcode"></i> <span translate="QRCODE"></span></button>'},template:'<voucher-details app-user="appUser" company="selectedCompany" voucher-id="id" cancel-func="goToList"></voucher-details>',controller:["$scope","$stateParams",function(e,t){e.id=t.voucherGroupId,e.goToList=function(){$state.go("backend.vouchers",{},{reload:!0})}}]}).state("backend.company_info",{url:"/company_info",data:{pageTitle:"{{'COMPANY_INFO' | translate}}",pageSubTitle:["{{$root.selectedCompany.name}}",'<b ng-if="$root.selectedCompany.is_expired === true" class="text-danger" translate="EXPIRED"></b><span translate="EXPIRY_DATE" ng-if="$root.selectedCompany.is_expired !== true"></span>: {{$root.selectedCompany.admin_config.currentPackageExpireDate | amUtc | amLocal | amDateFormat: \'ll\'}}','<span class="sand-box-flag text-warning" translate="SANDBOX" ng-if="$root.selectedCompany.is_sandbox === true"></span>','<a href="javascript: void(0)" company-qr-code-popup-btn company="$root.selectedCompany" app-user="appUser" class="qrcode"><i class="fa fa-qrcode"></i></a>'],btn:'<button type="button" class="btn btn-danger" company-delete-btn app-user="appUser" company="$root.selectedCompany"><i class="fa fa-trash"></i> <span translate="COMPANY.DELETE.BTN"></span></button>'},template:'<company-editor app-user="appUser" company="$root.selectedCompany"></company-editor>'}).state("backend.company_staff",{url:"/company_staff",data:{pageTitle:"{{'STAFF' | translate}}",pageSubTitle:["{{$root.selectedCompany.name}}","{{'TOTAL' | translate}}: {{$root.displayCounts}}"],btn:'<button class="btn btn-success" title="{{\'STAFF.NEW_BTN\' | translate}}" staff-list-new-item-btn app-user="$root.appUser" company="$root.selectedCompany"><i class="fa fa-plus"></i> <span translate="STAFF.NEW_BTN" class="hidden-xs hidden-sm"></span></button>'},template:'<staff-list app-user="appUser" company="$root.selectedCompany"></staff-list>'}),e},c=function(r,c,u,p){return n=r,a=c,i=u,o=p,t=p.rootDir.views,e=this,i.html5Mode(!0),s(),e};angular.module("shmApp.routes",["ui.router","shmApp.config"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","appConf",c])}(),function(){"use strict";var e,t,n,a=function(a,i,o){e=a,t=i,n=o,t.addPart(n.rootDir.languages),e.useLoader("$translatePartialLoader",{urlTemplate:"{part}{lang}.json"}),e.useLoaderCache("$translationCache"),e.fallbackLanguage(n.default.language),e.preferredLanguage(n.default.language),e.useSanitizeValueStrategy("escapeParameters")};angular.module("shmApp.languages",["pascalprecht.translate"]).config(["$translateProvider","$translatePartialLoaderProvider","appConf",a])}(),function(){"use strict";angular.module("shmApp.config",[]).constant("appConf",function(){var e={};return e.APIs={default:"https://api.showmine.com.au/",china:"https://ecs.showmine.com/"},e.apiRegion="default",{appName:"ShowMine",author:{name:"Sysbox Pty Ltd",URL:"http://sysbox.com.au"},rootDir:{views:"app/views/",images:"app/images/",languages:"app/languages/"},url:{api:function(){return e.APIs[e.apiRegion]},web:"http://www.showmine66.com"},userRegion:{setAPIRegion:function(t){e.apiRegion=t},checkingAPI:"http://ip-api.com/json/"},localStorageKeyPrefix:"SHM_ADMIN_",default:{momentJs:{locale:"en"},language:"australia"},community:{note:{id:"5c57b138ceb9da7958daba251bdad8f6",name:"CONSULTATION"},group_buy:{id:"552a8c864c2628440e4d85d935b669af",name:"Jie Long"},product:{id:"5d4074718bbed2c47a83bbbb2469b15a",name:"ITEM ADS"}},external_keys:{google_map:"AIzaSyC7TkwBa6hrQAE9mu6s88oIxV70JKsTIXM"}}}())}(),function(){"use strict";var e,t,n,a,i,o,r,s,c,u,p,l,m=function(n){e.hash(n),t()},d=function(n,a){t.yOffset=a,e.hash(n),t()},g=function(n){e.hash(n),setTimeout(function(){t()},500)},f=function(){m("app-top")},v=function(e){return/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/.test(e)},y=function(e){return new RegExp("^data:image/","i").test(e)},h=function(e){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)},C=function(e){return y(e)||v(e)},b=function(e){var t={};return t.imgSrc=o.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e.thumbnailArray=o.getImgArray(e.images_in_diff_sizes),e&&e.thumbnailArray&&e.thumbnailArray[0]&&!0===C(e.thumbnailArray[0].url)&&(t.imgSrc=e.images[0].url),t.imgSrc},E=function(e){var t={};return t.imgSrc=o.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e&&e.logo_img&&!0===C(e.logo_img.url)&&(t.imgSrc=e.logo_img.url),t.imgSrc},A=function(e,t){var n={};return n.size_name=t||"LARGE",n.imgDefaultSrc=o.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e.thumbnailArray=o.getImgArray(e.images_in_diff_sizes,n.size_name),n.imgSrc=U(e.thumbnailArray,0),null===n.imgSrc?n.imgDefaultSrc:n.imgSrc},U=function(e,t){return e[t]?!0===e[t].mime_type.toLowerCase().startsWith("image")?e[t].url:U(e,1*t+1):null},S=function(e,t,n){return _.contains(e,t)||n},I=function(e){var t={};return t.imgSrc=o.getAppAbsUrlRoot()+"/app/images/default-avatar.png",e&&e.avatar_img&&!0===C(e.avatar_img)&&(t.imgSrc=e.avatar_img),t.imgSrc},T=function(e){return/^\s*$/.test(e)},k=function(e){T(e),n.pageTitle=e},L=function(e){n.pageDescription=e},D=function(t){var n={};return n.relative_path=void 0===t?"":"/"+t,e.protocol()+"://"+e.host()+":"+e.port()+n.relative_path},w=function(t){var n={};return n.exclude_hash=void 0===t||t,!0===n.exclude_hash?e.absUrl().split("#")[0]:e.absUrl()},O=function(t){var n={};if(n.url=s.href(t.name?t.name:t.current.name,t.params,{absolute:!0}),n.queryParams=e.search(),n.queryParams&&Object.keys(n.queryParams).length>0){if(n.parsedUrl=new URL(n.url),n.missingParams={},angular.forEach(n.queryParams,function(e,t){n.parsedUrl.searchParams.has(t)||(n.missingParams[t]=e)}),!(Object.keys(n.missingParams).length>0))return n.url;!0===n.url.includes("?")?n.url=n.url+"&"+c(n.missingParams):n.url=n.url+"?"+c(n.missingParams)}return n.url},M=function(e){return e?String(e).replace(/&nbsp;/gi,"").replace(/<[^>]+>/gm,""):""},P=function(e){return e?e.replace(/[^a-z0-9\u4e00-\u9eff]/gi,"").toLowerCase():""},$=function(e){var t={addressMap:{}};for(t.i=0;t.i<e.address_components.length;t.i++)t.addressType=e.address_components[t.i].types[0],t.addressMap[t.addressType]=e.address_components[t.i].long_name;return t.address={street:(t.addressMap.street_number?t.addressMap.street_number+" ":"")+(t.addressMap.route?t.addressMap.route:""),suburb:t.addressMap.locality?t.addressMap.locality:t.addressMap.colloquial_area?t.addressMap.colloquial_area:"",state:t.addressMap.administrative_area_level_1?t.addressMap.administrative_area_level_1:"",country:t.addressMap.country?t.addressMap.country:"",postcode:t.addressMap.postal_code?t.addressMap.postal_code:""},e.geometry&&e.geometry.location&&(t.address.latitude=e.geometry.location.lat,t.address.longitude=e.geometry.location.lng),t.address},R=function(e){return{formatted_address:(e.street?e.street+", ":"")+(e.suburb?e.suburb+", ":"")+(e.state?e.state+", ":"")+(e.country?e.country+", ":""),address_components:[{long_name:e.street,short_name:e.street,types:["route"]},{long_name:e.suburb,short_name:e.suburb,types:["locality"]},{long_name:e.state,short_name:e.state,types:["administrative_area_level_1"]},{long_name:e.country,short_name:e.country,types:["country"]},{long_name:e.postal_code,short_name:e.postal_code,types:["postcode"]}],geometry:{location:{lat:function(){return e.latitude},lng:function(){return e.longitude}}}}},N=function(e){e||(e="DEFAULT"),a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:i.viewRootDir+"directives/user/subscribeAlert.html",controllerAs:"ctrl",controller:["subscribeType","$uibModalInstance",function(e,t){var n=this;return n.type=e,n.$uibModalInstance=t,n.cancel=function(){n.$uibModalInstance.dismiss("cancel")},n}],resolve:{subscribeType:function(){return e}}})},F=function(e,t){var n={};return n.imgArray=[],n.targetSize=void 0===t?"MID":t,e.origImages?(angular.forEach(e.origImages,function(t,a){if("MID"===n.targetSize)n.midImg=e.midImages[a],n.targetImg=n.midImg?n.midImg:t;else if("SMALL"===n.targetSize)n.smallImg=e.smallImages[a],n.targetImg=n.smallImg?n.smallImg:t;else{if("LARGE"!==n.targetSize)return;n.largeImg=e.largeImages[a],n.targetImg=n.largeImg?n.largeImg:t}n.targetImg.comment=t.comment,n.imgArray.push(n.targetImg)}),n.imgArray):n.imgArray},B=function(e){return r.createHash(e)},x=function(e){try{if(e=e||"",""==e.trim())return!0;return void 0!==angular.element(e).attr("meipian-style")}catch(e){return!1}},W=function(e){var t=_.where(e.tags,{type_id:"b6ff88cde7078468bf1da52e5517d548"});return t&&t.length>0?t[0].name:""},j=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.payment_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].payments||(t[n].payments={}),angular.forEach(e.receipts,function(a){t[n].payments[e.id]||(t[n].payments[e.id]=_.omit(e,"receipts"),t[n].payments[e.id].company=a.item.company),t[n].payments[e.id].items||(t[n].payments[e.id].items={}),t[n].payments[e.id].items[a.item_id]||(t[n].payments[e.id].items[a.item_id]=a.item),t[n].payments[e.id].items[a.item_id].receipts||(t[n].payments[e.id].items[a.item_id].receipts={}),t[n].payments[e.id].items[a.item_id].receipts[a.id]||(t[n].payments[e.id].items[a.item_id].receipts[a.id]=_.omit(a,"item"))})}),t},G=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].items&&t[n].items[e.item_id]||(t[n].items={},t[n].items[e.item_id]=e.item),t[n].items[e.item_id].receipts&&t[n].items[e.item_id].receipts[e.id]||(t[n].items[e.item_id].receipts={},t[n].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}),t},V=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].items||(t[n].items={}),t[n].items[e.item_id]||(t[n].items[e.item_id]=e.item),t[n].items[e.item_id].receipts||(t[n].items[e.item_id].receipts={}),t[n].items[e.item_id].receipts[e.id]||(t[n].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}),t},Y=function(e){var t={};return angular.forEach(e,function(e){if(e.item&&e.item.company_id){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].companies||(t[n].companies={}),t[n].companies[e.item.company.id]||(t[n].companies[e.item.company.id]=e.item.company),t[n].companies[e.item.company.id].items||(t[n].companies[e.item.company.id].items={}),t[n].companies[e.item.company.id].items[e.item_id]||(t[n].companies[e.item.company.id].items[e.item_id]=e.item),t[n].companies[e.item.company.id].items[e.item_id].receipts||(t[n].companies[e.item.company.id].items[e.item_id].receipts={}),t[n].companies[e.item.company.id].items[e.item_id].receipts[e.id]||(t[n].companies[e.item.company.id].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}}),t},Q=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.payment_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].payments||(t[n].payments={}),t[n].payments[e.vendor_payment_group_id]||(t[n].payments[e.vendor_payment_group_id]=e.vendor_payment_group),t[n].payments[e.vendor_payment_group_id].vendors||(t[n].payments[e.vendor_payment_group_id].vendors={}),angular.forEach(e.receipts,function(a){t[n].payments[e.vendor_payment_group_id].vendors[e.id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id]=_.omit(e,"receipts"),t[n].payments[e.vendor_payment_group_id].vendors[e.id].company=a.item.company),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items={}),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id]=a.item),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts={}),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts[a.id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts[a.id]=_.omit(a,"item"))})}),t},z=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},H=function(e){var t={modules:{}};return angular.forEach(["group_buy","voucher","note"],function(e){t.modules[e]={create:!1}}),!0===z(e.admin_config)&&(e.admin_config=angular.fromJson(e.admin_config)),e.admin_config&&null!==e.admin_config&&"object"==typeof e.admin_config&&(e.admin_config.is_allow_create_voucher&&!0===e.admin_config.is_allow_create_voucher&&(t.modules.voucher.create=!0),e.admin_config.is_allow_create_news&&!0===e.admin_config.is_allow_create_news&&(t.modules.note.create=!0),e.admin_config.is_allow_create_jielong&&!0===e.admin_config.is_allow_create_jielong&&(t.modules.group_buy.create=!0,e.admin_config.is_allow_multi_pickup&&!0===e.admin_config.is_allow_multi_pickup&&(t.modules.group_buy.pickup_location=!0))),t.modules},q=function(e,t){var a=angular.copy(t);return!0===z(t.config)&&(a.config=angular.fromJson(t.config)),!0===z(t.admin_config)&&(a.admin_config=angular.fromJson(t.admin_config)),t.admin_config||(a.admin_config={}),a.admin_config.currentPackageExpireDate=a.admin_config.currentPackageExpireDate?a.admin_config.currentPackageExpireDate:"2016-12-31 00:00:00",a.admin_config.currentPackage=a.admin_config.currentPackage?a.admin_config.currentPackage:"none",a.modules=H(t),a.isCurrentUserAdmin=e.adminOfCompanyIds&&e.adminOfCompanyIds.indexOf(t.id)>=0,a.isCompanyAdmin=n.appUser.adminOfCompanyIds&&n.appUser.adminOfCompanyIds.indexOf(t.id)>=0,a},J=function(e){if(n.appUser&&n.appUser.userCompany&&0!==n.appUser.userCompany.length)return n.selectedCompany=q(n.appUser,e),u.setItem("selectedCompany_"+n.appUser.id,n.selectedCompany),o},K=function(){if(n.appUser&&n.appUser.id)return u.getItem("selectedCompany_"+n.appUser.id)},X=function(){if(n.appUser&&n.appUser.id)return u.getItem("all_companies_"+n.appUser.id)},Z=function(e){if(!n.appUser||!n.appUser.id)return o;u.setItem("all_companies_"+n.appUser.id,e)},ee=function(e){var t=X();return t&&t.length>0&&(angular.forEach(t,function(n,a){n.id===e.id&&(t[a]=e)}),Z(t)),t},te=function(e){var t=angular.copy(e);return!0===z(e.config)&&(t.config=angular.fromJson(e.config)),t},ne=function(){return moment.utc("9999-12-31 23:59:59")},ae=function(){return moment.utc()},ie=function(){return{country:"Australia",postcode:"",state:"Victoria",street:"",suburb:""}},oe=function(e,t){return{message:e,errors:t}},re=function(e){var t={};return t.url=l.trustAsResourceUrl(i.userRegion.checkingAPI),t.params={},e&&(t.params.jsonpCallbackParam=e),p.jsonp(t.url,t.params)},se=function(_,U,H,se,ce,ue,pe,le,me,de,ge){return o=this,o.now=moment(),e=_,t=U,n=H,a=se,i=ce,r=ue,s=pe,c=le,u=me,p=de,l=ge,o.isUrl=v,o.getMaxUtcDateTime=ne,o.getNowUtcDateTime=ae,o.getDefaultAddressObj=ie,o.isJsonString=z,o.isDataUrl=y,o.isEmail=h,o.isImageUrl=C,o.getItemDefaultImageUrl=b,o.getCompanyDefaultImageUrl=E,o.getUserAvatarImageUrl=I,o.scrollToTop=f,o.scrollTo=m,o.scrollToWithOffset=d,o.delayScrollTo=g,o.setWebTitle=k,o.setWebDescription=L,o.getAppAbsUrlRoot=D,o.getCurrentUrl=w,o.getCurrentUrlFromPageState=O,o.stripHtmlTags=M,o.isBlank=T,o.mapGoogleMapToAddressObj=$,o.buildGooglePlacesResult=R,o.displaySubscribeModal=N,o.getImgArray=F,o.getItemDefaultThumbnailUrl=A,o.md5Hash=B,o.isConvertableToMeiPianStyleHtml=x,o.returnCommunityNameFromItem=W,o.getUrlSafeString=P,o.adminOfCompany=S,o.processMulvendorPayment=j,o.processReceipt=G,o.processAllReceipt=V,o.processAllReceiptAllCompanies=Y,o.processVendorPaymentWithGroupId=Q,o.setSelectedCompany=J,o.getSelectedCompany=K,o.formatCompany=q,o.getAllStoredCompanies=X,o.setAllStoredCompanies=Z,o.updateCompanyInAllStoredCompanies=ee,o.formatItem=te,o.getErrorMsgObj=oe,o.getUserRegion=re,o};angular.module("shmApp.services",["angular-md5"]).service("UtilsService",["$location","$anchorScroll","$rootScope","$uibModal","appConf","md5","$state","$httpParamSerializer","StorageService","$http","$sce",se])}(),function(){"use strict";var e,t,n,a,i,o,r,s={},c=function(e){return s.get(r.url.api()+"wechat/js/conf",{params:e})},u=function(e,t){wx&&"function"==typeof wx.config&&(wx.config(t),g(e,t))},p=function(t){return e.md5Hash(t)},l=function(e,a){var i=angular.fromJson(t.localStorage.getItem(r.localStorageKeyPrefix+"wx"));return i||(i={}),i[p(e)]=a,t.localStorage.setItem(r.localStorageKeyPrefix+"wx",angular.toJson(i)),n},m=function(e){var n=angular.fromJson(t.localStorage.getItem(r.localStorageKeyPrefix+"wx"));return n?n[p(e)]:null},d=function(e){var t={};if(t.stored_config=m(e),"object"==typeof t.stored_config&&t.stored_config&&""!==t.stored_config.timestamp&&(t.now_unix_timestamp=Math.floor(Date.now()/1e3),1*t.now_unix_timestamp-1*t.stored_config.timestamp<=7e3))return t.stored_config},g=function(e,t){return l(e,t),n},f=function(e,t){var a=d(e);return a?(u(e,a),t&&t.loaded&&t.loaded(),n):(n.loadingWechatJsConf=!0,n.loadingWechatJsConfErr=void 0,c({url:e}).then(function(n){n.data&&n.data.js&&(u(e,n.data.js),void 0!==t&&y(t))},function(e){n.loadingWechatJsConfErr=e.data}).finally(function(){n.loadingWechatJsConf=!1}),n)},v=function(e){wx&&"function"==typeof wx.ready&&"function"==typeof e&&wx.ready(function(){e()})},y=function(e){jQuery(document).ready(function(){o(function(){wx.ready(function(t){n.weChatJsLoaded=!0,e.menuShareAppMessage&&wx.onMenuShareAppMessage(e.menuShareAppMessage),e.menuShareTimeline&&wx.onMenuShareTimeline(e.menuShareTimeline),e.getLocation&&wx.getLocation({type:"wgs84",success:function(t){"function"==typeof e.getLocation.success&&e.getLocation.success(t)},fail:function(t){"function"==typeof e.getLocation.fail&&e.getLocation.fail(t)}}),e.loaded&&"function"==typeof e.loaded&&e.loaded(t)})},500)})},h=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/MicroMessenger/i)},C=function(){var e={};return e.userAgent=t.navigator.userAgent,!!e.userAgent.match(/(iPad|iPhone|iPod)/g)},b=function(){var e={};return e.userAgent=t.navigator.userAgent,!e.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i)},_=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/WindowsWechat/i)},E=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/Chrome/i)},A=function(){return r.webMainUrl+a.href("auth.getWechatUser",{domain:encodeURIComponent(location.origin),origurl:encodeURIComponent(location.href)},{absolute:!1})},U=function(e){return s.post(r.url.api()+"wechat/me",{state_redirect_obj:e,wechat_auth_url:A()})},S=function(e){return U(e).then(function(e){if(e.data.auth_url)return void(t.location.href=e.data.auth_url)}),n},I=function(e){return s.post(r.url.api()+"wechat/open-platform/generatePreAuthorizationUrl",e)},T=function(e){return s.post(r.url.api()+"wechat/open-platform/bindCompanyWithAppId",e)},k=function(c,u,p,l,m,d,g){return s=c,t=u,e=p,a=l,i=m,o=d,r=g,n=this,n.loadWeChatJsConf=f,n.openedInWeChat=h,n.getAuthPageUrl=A,n.loginAndRedirect=S,n.openInIphone=C,n.openInDesktop=b,n.openInWindowsWechat=_,n.openInGoogleChrome=E,n.runWhenWXReady=v,n.getPreAuthorizationUrl=I,n.bindCompanyWithAppId=T,n};angular.module("shmApp.services").service("WeChatService",["$http","$window","UtilsService","$state","$auth","$timeout","appConf",k])}(),function(){"use strict";var e,t,n,a,i={},o=function(t){return i.post(e.url.api()+"user/login",t)},r=function(){a.clear(),t.setToken(""),t.logout()},s=function(){return i.get(e.url.api()+"user/me")},c=function(t,n){return i.get(e.url.api()+"wechat/getUser",{params:{code:t,state:n}})},u=function(t){return i.post(e.url.api()+"wechat/web/connect/url",t)},p=function(t,n){return i.get(e.url.api()+"wechat/web/getUser",{params:{code:t,state:n}})},l=function(e){t.setToken(e)},m=function(){return t.getToken()},d=function(){return!!t.isAuthenticated()&&(!n.appUser&&void 0!==n.appUser&&""!=n.appUser.id)},g=function(t){return i.get(e.url.api()+"social-login/"+t)},f=function(t,n){return i.get(e.url.api()+"social-login/"+t+"/callback",{params:{code:n}})},v=function(t,n){return i.get(e.url.api()+"social-login/facebook/companyRedirect")},y=function(t){return i.get(e.url.api()+"social-login/facebook/companyBind",{params:{code:t}})},h=function(t){return i.post(e.url.api()+"user/validateLoginCode",{login_code:t})},C=function(){return i.post(e.url.api()+"user/generateLoginSubscribeQr")},b=function(t,n){return i.get(e.url.api()+"user/checkSubscribeLoginLog/"+t,{params:n})},_=function(_,E,A,U,S){return i=_,e=E,t=A,n=U,a=S,{login:o,loginWithTempCode:h,logout:r,isAuthenticated:d,getWechatLoginUrl:u,getWechatUserFromCode:c,getWechatWebUserFromCode:p,getMe:s,setAuthToken:l,getAuthToken:m,getSocialMediaLoginRedirectUrl:g,getSocialMediaUserFromCode:f,facebookPageCompanyRedirect:v,facebookPageBindWithCode:y,generateLoginQrCode:C,checkLoginStatus:b}};angular.module("shmApp.services").service("AuthService",["$http","appConf","$auth","$rootScope","StorageService",_])}(),function(){"use strict";var e,t,n,a=function(a,i){return e.localStorage.setItem(t.localStorageKeyPrefix+a,angular.toJson(i)),n},i=function(n){var a=e.localStorage.getItem(t.localStorageKeyPrefix+n);return angular.fromJson(a)},o=function(a){return e.localStorage.removeItem(t.localStorageKeyPrefix+a),n},r=function(){
return e.localStorage.clear(),n},s=function(s,c){return e=s,t=c,n=this,n.setItem=a,n.getItem=i,n.removeItem=o,n.clear=r,n};angular.module("shmApp.services").service("StorageService",["$window","appConf",s])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.url.api()+"banner/company/"+n)},a=function(n,a){return t.post(e.url.api()+"banner/company/"+n,{banners:a})},i=function(n,a){return t.put(e.url.api()+"asset/"+n+"/comment",a)},o=function(o,r){return t=o,e=r,{getCompanyBanners:n,createCompanyBanner:a,updateBannerComment:i}};angular.module("shmApp.services").service("BannerService",["$http","appConf",o])}(),function(){"use strict";var e,t={},n=function(n){return t.post(e.url.api()+"company",n)},a=function(n,a){return t.put(e.url.api()+"company/"+n,a)},i=function(n){return t.get(e.url.api()+"company/"+n)},o=function(n){return t.post(e.url.api()+"company/"+n+"/genCompanyPageQrCode")},r=function(n,a){return t.post(e.url.api()+"company/"+n+"/approveCompanyStaff",a)},s=function(n){return t.delete(e.url.api()+"company/"+n)},c=function(n){return t.get(e.url.api()+"company",{params:n})},u=function(n,a){return t.get(e.url.api()+"company/user/"+n,{params:a})},p=function(n,a,i){return t.post(e.url.api()+"company/user/"+n+"/"+a,i)},l=function(n,a){return t.delete(e.url.api()+"company/user/"+n+"/"+a)},m=function(n,a,i){return t.put(e.url.api()+"company/user/"+n+"/"+a,i)},d=function(n,a){return t.post(e.url.api()+"company/messages/"+n,a)},g=function(n,a){return t.put(e.url.api()+"company/messages/"+n,a)},f=function(n,a){return t.delete(e.url.api()+"company/messages/"+n,a)},v=function(n,a){return t.get(e.url.api()+"company/messages/"+n,{params:a})},y=function(n,a){return t.get(e.url.api()+"company/messages/list/"+n,{params:a})},h=function(n){return t.post(e.url.api()+"company/fav",{company_id:n})},C=function(n){return t.delete(e.url.api()+"company/fav",{params:{company_id:n}})},b=function(n){return t.get(e.url.api()+"company/fav",{params:n})},_=function(n){return t.get(e.url.api()+"company/section/"+n)},E=function(n,a){return t.post(e.url.api()+"company/section/"+n,{companySection:a})},A=function(n,a){return t.put(e.url.api()+"company/display/"+n,a)},U=function(n,a){return t.post(e.url.api()+"company/sendMessage/"+n,a)},S=function(n){return t.post(e.url.api()+"company/apply",n)},I=function(n,a){return t.get(e.url.api()+"company/validateApplication/"+n,{params:a})},T=function(n){return t.post(e.url.api()+"domain",{domain:n})},k=function(n,a){return t.post(e.url.api()+"company/broadcastArticles/"+n,a)},L=function(n){return t.post(e.url.api()+"company/bindFacebook",n)},D=function(n,a){return t.post(e.url.api()+"company/captcha/"+n,a)},w=function(n){return t.get(e.url.api()+"company/location/"+n)},O=function(n,a){return t.post(e.url.api()+"company/location/"+n,a)},M=function(n,a,i){return t.put(e.url.api()+"company/location/"+n+"/"+a,i)},P=function(n,a){return t.delete(e.url.api()+"company/location/"+n+"/"+a)},$=function(n,a){return t.get(e.url.api()+"company/voucher-group/company/"+n,{params:a})},R=function(n){return t.get(e.url.api()+"company/voucher-group/"+n)},N=function(n){return t.post(e.url.api()+"company/voucher-group",n)},F=function(n,a){return t.put(e.url.api()+"comment/voucher/"+n+"/markSent",a)},B=function(n){return t.post(e.url.api()+"company/voucher-group/"+n+"/obtainOwnership")},x=function(){return t.post(e.url.api()+"company/voucher-group/fetchVoucherRandomly")},W=function(n){return t.post(e.url.api()+"company/voucher-campaign",n)},j=function(n){return t.get(e.url.api()+"company/voucher-campaign/"+n)},G=function(n,a){return t.put(e.url.api()+"company/voucher-campaign/"+n,a)},V=function(n,a){return t.get(e.url.api()+"company/voucher-campaign/company/"+n,{params:a})},Y=function(n){return t.get(e.url.api()+"company/voucher-campaign",{params:n})},Q=function(n){return t.post(e.url.api()+"company/voucher-campaign/"+n+"/fetchVoucherRandomly")},z=function(n,a){return t.get(e.url.api()+"company/voucher-campaign/"+n+"/voucherUsersUnderCampaign",{params:a})},H=function(n){return t.get(e.url.api()+"company/voucher-group/companies",{params:n})},q=function(n,a){return t.put(e.url.api()+"company/voucher-group/"+n,a)},J=function(n){return t.get(e.url.api()+"company/paid/companies",{params:n})},K=function(n){return t.post(e.url.api()+"company/voucher-group/preview",n)},X=function(n,a){return t.get(e.url.api()+"wechat/card/assignCard/"+n,{params:a})},Z=function(n,a){return t.put(e.url.api()+"company/voucher-group/cancel/"+n+"/"+a)},ee=function(n){return t.post(e.url.api()+"company/voucher-group/share/"+n)},te=function(n,a){return t.post(e.url.api()+"company/"+n+"/genAddUserQRCode",a)},ne=function(n,a){return t.post(e.url.api()+"company/voucher-group/"+n+"/genVoucherQrCode",a)},ae=function(n){return t.get(e.url.api()+"company/"+n+"/tags")},ie=function(ie,oe){return t=ie,e=oe,{deactivateCompany:s,updateInfo:a,createInfo:n,getCompanyDetails:i,createNewCompanyUser:p,getUserList:u,deleteCompanyUser:l,updateCompanyUser:m,getAllCompanies:c,updateComment:g,addCommentToAnCompany:d,deleteCompanyComment:f,getCompanyComments:y,markAsFavourite:h,removeAsFavourite:C,getFavCompanies:b,getACompanyComment:v,getCompanySections:_,createCompanySections:E,displayCompanyItems:A,applyCompany:S,checkApplicationStatus:I,getByDomain:T,broadcastItemsToWechat:k,bindFacebookWithPage:L,sendMessageToCompany:U,createCaptcha:D,getCompanyPickupLocations:w,createCompanyPickupLocation:O,updateCompanyPickupLocation:M,deleteCompanyPickupLocation:P,getVoucherGroupsUnderCompany:$,getVoucherGroupById:R,createCompanyVoucherGroup:N,markVoucherSent:F,obtainVoucherOwnership:B,obtainRandomVoucherOwnership:x,createCompanyVoucherCampaign:W,getCompanyVoucherCampaignDetails:j,updateCompanyVoucherCampaignDetails:G,getCompanyCampaignList:V,getAllCampaignList:Y,obtainRandomVoucherUnderCampaign:Q,getCampaignUsersLists:z,getCompaniesWithVoucherGroups:H,updateCompanyVoucherGroup:q,getPaidCompanies:J,previewVoucher:K,assignCard:X,cancelCompanyVoucherGroup:Z,sendWeChatNewsOfVoucherGroup:ee,genAddUserQRCode:te,getCompanyQrcodes:o,genVoucherQrCode:ne,approveCompanyStaff:r,getCompanyTags:ae}};angular.module("shmApp.services").service("CompanyService",["$http","appConf",ie])}(),function(){"use strict";var e,t={},n=function(n,a){return t.get(e.url.api()+"item/seller/"+n,{params:a})},a=function(n){return t.get(e.url.api()+"item/"+n)},i=function(n){return t.post(e.url.api()+"item",n)},o=function(n,a){return t.put(e.url.api()+"item/"+n,a)},r=function(n){return t.post(e.url.api()+"payment/receipt",n)},s=function(n,a){return t.post(e.url.api()+"comment/item/"+n,a)},c=function(n,a){return t.post(e.url.api()+"jielong/"+n+"/subitems",a)},u=function(n,a){return t.put(e.url.api()+"jielong/"+n+"/subitems",a)},p=function(n,a){return t.get(e.url.api()+"comment/item/"+n,{params:a})},l=function(n,a){return t.get(e.url.api()+"jielong/isInJielong/"+n,a)},m=function(n,a){return t.get(e.url.api()+"jielong/getAllJielong/"+n,a)},d=function(n,a){return t.put(e.url.api()+"comment/"+n,a)},g=function(n,a){return t.get(e.url.api()+"comment/"+n,a)},f=function(n,a){return t.delete(e.url.api()+"comment/"+n,{params:a})},v=function(n){return t.get(e.url.api()+"item/search",{params:n})},y=function(n,a){return t.get(e.url.api()+"item/community/"+n,{params:a})},h=function(n,a){return t.get(e.url.api()+"item/company/"+n,{params:a})},C=function(n,a){return t.get(e.url.api()+"item/company/"+n+"/onlinePayment",{params:a})},b=function(n,a){return t.get(e.url.api()+"item/company/"+n+"/consultation",{params:a})},_=function(n,a){return t.get(e.url.api()+"item/company/"+n+"/product",{params:a})},E=function(n,a){var i={};return i.parameters=a||{},i.parameters.community_id=e.community.group_buy.id,t.get(e.url.api()+"item/company/"+n,{params:i.parameters})},A=function(n,a){return t.put(e.url.api()+"item/"+n+"/end",a)},U=function(n,a){return t.put(e.url.api()+"item/"+n+"/sold",a)},S=function(n,a){return t.delete(e.url.api()+"item/"+n,a)},I=function(n,a){return t.post(e.url.api()+"item/"+n+"/abuse",a)},T=function(n,a){return t.get(e.url.api()+"item/"+n+"/pushTimes",a)},k=function(n,a){return t.put(e.url.api()+"item/"+n+"/push",a)},L=function(){return t.get(e.url.api()+"tag/predefined")},D=function(n){return t.get(e.url.api()+"jielong/blacklist",{params:n})},w=function(n){return t.get(e.url.api()+"jielong/blacklist/blacklistdetails",{params:n})},O=function(n){return t.get(e.url.api()+"utils/places-overseas",n)},M=function(n){return t.get(e.url.api()+"utils/geoip/isFromChina",n)},P=function(n,a,i){return t.post(e.url.api()+"item/poster/"+n,{url:a,is_showing_all_imgs:i})},$=function(n,a){return t.post(e.url.api()+"item/checkinqr/"+n,{url:a})},R=function(n,a){return t.post(e.url.api()+"item/checkin/"+n,{url:a})},N=function(n,a){return t.put(e.url.api()+"item/"+n+"/seller",{seller_id:a})},F=function(n,a){return t.get(e.url.api()+"item/"+n+"/guessYouLikeByTags",{params:a})},B=function(n){return t.get(e.url.api()+"item/guessYouLike",{params:n})},x=function(n){return t.get(e.url.api()+"item/history",{params:n})},W=function(n){return t.post(e.url.api()+"item/clone/"+n)},j=function(n,a){var i=a||{};return i.item_id=n,t.post(e.url.api()+"item/fav",i)},G=function(n,a){var i=a||{};return i.item_id=n,t.delete(e.url.api()+"item/fav",{params:i})},V=function(n){return t.get(e.url.api()+"item/fav",{params:n})},Y=function(n){return t.get(e.url.api()+"item/propertytype",{params:n})},Q=function(n){return t.get(e.url.api()+"comment/voucher/"+n)},z=function(n){return t.get(e.url.api()+"comment/voucher/"+n+"/validate")},H=function(n,a){return t.post(e.url.api()+"comment/voucher/"+n,a)},q=function(n,a){return t.post(e.url.api()+"comment/voucher/"+n+"/subitems",a)},J=function(n){return t.get(e.url.api()+"comment/voucher",{params:n})},K=function(n,a){return t.put(e.url.api()+"jielong/checkin/finish/"+n,a)},X=function(n){return t.get(e.url.api()+"item/topVisited",{params:n})},Z=function(n){return t.get(e.url.api()+"item/getItemsWithSpeicalTags",{params:n})},ee=function(n,a){return t.get(e.url.api()+"item/company/getItemsWithCompanyTags/"+n,{params:a})},te=function(n,a){return t.post(e.url.api()+"/jielong/"+n+"/genReportEmail",a)},ne=function(n,a,i){return t.get(e.url.api()+"comment/item/"+n+"/"+a,{params:i})},ae=function(n,a){return t.post(e.url.api()+"item/"+n+"/facebook",{params:a})},ie=function(n,a){return t.post(e.url.api()+"item/"+n+"/wordpress",{params:a})},oe=function(e){return e&&e.id?1!==parseInt(e.active)?"DEACTIVATED":!0===e.is_sold?"SOLD":!0===e.is_ended?"ENDED":1==e.is_draft?"DRAFT":!0===e.is_expired?"EXPIRED":!0!==e.is_published?"NOT_STARTED":"ACTIVE":""},re=function(n,a){return t.get(e.url.api()+"item/company/validateItemLimit/"+n,{params:a})},se=function(n,a){return t.get(e.url.api()+"item/"+n+"/history",{params:a})},ce=function(n){return t.post(e.url.api()+"item/"+n+"/genItemQrCode")},ue=function(ue,pe){return t=ue,e=pe,{getItemsForASeller:n,searchItems:v,searchItemsUnderCommunity:y,searchItemsUnderCompany:h,addCommentToAnItem:s,createItem:i,updateItem:o,createReceipt:r,getCommentsForAnItem:p,getItemDetails:a,reportItemAbuse:I,getLeftPushTimes:T,pushItem:k,markItemEnd:A,markItemSold:U,markItemDeactivate:S,getPredefinedTags:L,getPlacesOverseas:O,generateItemPoster:P,getIsFromChina:M,guessCurrentUserLike:B,guessUserLikeByTags:F,updateComment:d,getComment:g,setCommentsDeactivate:f,getMyHistory:x,getFavItems:V,cloneItem:W,markAsFavourite:j,removeAsFavourite:G,updateSeller:N,getIsInJielong:l,getAllJielong:m,generateCheckinQRCode:$,generateCheckinPoster:R,getPropertyTypes:Y,getVoucherDetails:Q,checkinVoucher:H,checkinVoucherWithSubItems:q,getMyVouchers:J,terminateJielong:K,getTopVisitItemsList:X,addJielongToAnItemWithKids:c,updateJielongToAnItemWithKids:u,getItemStatusName:oe,searchItemsUnderCompanyOnlyForProduct:_,searchItemsUnderCompanyOnlyForGroupBuy:E,searchBlackList:D,getItemsWithSpeicalTags:Z,getBlackListDetails:w,getItemsWithCompanyTags:ee,checkIfComanyUpperTheItemLimit:re,searchItemsUnderCompanyWithOnlinePayment:C,validateVoucherWhenNoUser:z,genJielongReportEmail:te,searchItemsUnderCompanyOnlyForConsultation:b,getItemHistories:se,updateJielongReportLocationData:ne,pushToFacebook:ae,pushToWordpress:ie,getItemQrCodes:ce}};angular.module("shmApp.services").service("ItemService",["$http","appConf",ue])}(),function(){"use strict";var e,t,n,a,i,o=["simplified-chinese","australia"],r=function(t){return e.use(t),"simplified-chinese"===t?a.changeLocale("zh-cn"):"australia"===t&&a.changeLocale("en"),i.setItem("selected-language",t),n},s=function(){var t={};return t.langKey=i.getItem("selected-language"),t.langKey&&null!==t.langKey&&""!==t.langKey||(t.langKey=e.use()),t.langKey},c=function(){return o},u=function(o,u,p,l){return e=o,t=u,a=p,i=l,n=this,n.switchLanguage=r,n.getLocalLanguageKey=s,n.getSupportedLanguages=c,n};angular.module("shmApp.services").service("LanguageService",["$translate","appConf","amMoment","StorageService",u])}(),function(){"use strict";var e,t,n,a=function(){var e=document.createElement("script");e.src="https://ditu.google.cn/maps/api/js?libraries=places&key="+n.external_keys.google_map+"&callback=initialize",e.async="",e.defer="",document.body.appendChild(e)},i=function(i,o,r){e=i,t=o,n=r;var s=t.defer();return e.initialize=function(){s.resolve()},a(),s.promise};angular.module("shmApp.services").service("loadGoogleMapLib",["$window","$q","appConf",i])}(),function(){"use strict";var e,t,n={},a={width:1200,height:8e3,quality:.8},i=function(e){return n.post(t.url.api()+"asset/wechat",e)},o=function(e,a){return n.put(t.url.api()+"asset/"+e+"/comment",a)},r=function(n){return e.upload({url:t.url.api()+"asset",file:n})},s=function(e){return n.post(t.url.api()+"asset/based64",e)},c=function(t){return e.resize(t,a)},u=function(a,u,p){return n=a,t=p,e=u,{uploadThoughWechat:i,updateAssetComment:o,uploadAsset:r,imgResize:c,uploadBase64Asset:s}};angular.module("shmApp.services").service("AssetService",["$http","Upload","appConf",u])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<"},template:"",link:function(n,i,o){n.appConf=e;var r={};t.current.data.pageTitle&&(r.pageTitle=angular.element('<div class="title"></div>'),r.pageTitle.append(t.current.data.pageTitle),a(r.pageTitle)(n),i.append(r.pageTitle)),t.current.data.pageSubTitle&&(r.subTitle=angular.element('<div class="subtitle"></div>'),angular.isArray(t.current.data.pageSubTitle)?angular.forEach(t.current.data.pageSubTitle,function(e){r.subTitle.append('<div class="subtitle-part">'+e+"</div>")}):r.subTitle.append('<div class="subtitle-part">'+t.current.data.pageSubTitle+"</div>"),a(r.subTitle)(n),i.append(r.subTitle)),t.current.data.btn&&(r.btnWrapper=angular.element('<div class="btn-wrapper"></div>'),r.btnWrapper.append('<div class="btn-part">'+t.current.data.btn+"</div>"),a(r.btnWrapper)(n),i.append(r.btnWrapper))}}};angular.module("shmApp.directives").directive("backendPageTitle",["appConf","$state","$rootScope","$compile",e])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.rootDir.views+"backend/bottomMenu.html"}};angular.module("shmApp.directives").directive("bottomMenu",["appConf",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<"},templateUrl:e.rootDir.views+"backend/brandDiv.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("brandDiv",["appConf","$rootScope",e])}(),function(){"use strict";var e=function(){return[{name:"DASHBOARD",icon:"fa fa-dashboard",state:"backend.dashboard"},{sectionName:"COMPONENTS"},{name:"NOTES",icon:"fa fa-file",state:"backend.notes"},{name:"PRODUCTS",icon:"fa fa-list",state:"backend.products"},{name:"GROUP_BUYS",icon:"fa fa-hand-paper-o",state:"backend.group_buys"},{name:"VOUCHERS",icon:"fa fa-tags",state:"backend.vouchers"}]},t=function(){return[{sectionName:"MY_COMPANY"},{name:"COMPANY_INFO",icon:"fa fa-cog",state:"backend.company_info"},{name:"STAFF",icon:"fa fa-users",state:"backend.company_staff"}]},n=function(n,a,i){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:n.rootDir.views+"backend/mainMenu.html",link:function(n,o,r){n.navigateTo=function(e){a.go(e,{},{reload:!0})},n.currentStateName=a.current.name,n.adminMenuItems=[],(i.appUser.adminOfCompanyIds.indexOf(i.selectedCompany.id)>-1||!0===i.appUser.is_admin)&&(n.adminMenuItems=t()),n.menuItems=e().concat(n.adminMenuItems)}}};angular.module("shmApp.directives").directive("mainMenu",["appConf","$state","$rootScope",n])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{appUser:"<"},templateUrl:e.rootDir.views+"backend/toggleLeftMenuWidthBtn.html",link:function(e,a,i){e.toggleMinLeftMenu=function(){t.showMinLeftMenu=!0!==t.showMinLeftMenu,n.setItem("showMinLeftMenu",t.showMinLeftMenu)},t.showMinLeftMenu=n.getItem("showMinLeftMenu")}}};angular.module("shmApp.directives").directive("toggleLeftMenuWidthBtn",["appConf","$rootScope","StorageService",e])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.rootDir.views+"backend/topMenu.html"}};angular.module("shmApp.directives").directive("topMenu",["appConf",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"banner/bannerList.html",link:function(e,n,a){e.getBanners=function(){e.gettingBanners=!0,e.gettingBannersErr=void 0,t.getCompanyBanners(e.company.id).then(function(t){e.banners=t.data},function(t){e.gettingBannersErr=t.data}).finally(function(){e.gettingBanners=void 0})},e.saveCompanyBanners=function(n){if(n){var a={};a.comment=n.asset.comment||"",e.savingBanners=!0,e.savingBannerErr=void 0,t.updateBannerComment(n.asset.id,a).then(function(e){},function(t){e.savingCommentErr=t.data})}t.createCompanyBanner(e.company.id,e.banners).then(function(e){},function(t){e.savingBannerErr=t.data}).finally(function(){e.savingBanners=void 0})},e.removeBannerFromBanners=function(t){e.banners=_.without(e.banners,t),e.saveCompanyBanners()},e.getBanners(),e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin}}};angular.module("shmApp.directives").directive("bannerList",["appConf","BannerService",e])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{appUser:"<",banner:"<",company:"<",editMode:"<?",callBackSave:"&?",callBackDelete:"&?"},templateUrl:e.rootDir.views+"banner/bannerListItem.html",link:function(e,t,n){e.goEditMode=function(){e.editMode=!0},e.cancelEditMode=function(){angular.copy(e.banner,e.tmpBanner),e.editMode=!1},e.saveChange=function(){e.editMode=!1,e.tmpBanner.asset.id===e.banner.asset.id&&e.tmpBanner.link_to===e.banner.link_to&&e.tmpBanner.asset.comment===e.banner.asset.comment||(angular.copy(e.tmpBanner,e.banner),e.callBackSave()(e.banner))},e.deleteBanner=function(){e.callBackDelete(e.banner)},e.editMode=!1,e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.tmpBanner=angular.copy(e.banner)}}};angular.module("shmApp.directives").directive("bannerListItem",["appConf",e])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.appUser=t,i.company=n,i.banners=a,i.newBanner={link_to:"",asset:{}},i.assetArray=[],i.cancel=function(){e.dismiss("cancel")},i.save=function(){if(!i.assetArray[0]||!i.assetArray[0].id)return i.newBannerErr=!0,!1;i.newBanner.asset=i.assetArray[0],i.banners.push(i.newBanner),e.close(i.newBanner)}},t=function(t,n){return{restrict:"A",scope:{appUser:"<",company:"<",banners:"<",succFunc:"&?"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"banner/bannerCreatePanel.html",controller:["$uibModalInstance","appUser","company","banners",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},company:function(){return a.company},banners:function(){return a.banners}}}).result.then(function(e){"function"==typeof a.succFunc&&"function"==typeof a.succFunc()&&a.succFunc()(e)})})}}};angular.module("shmApp.directives").directive("bannerCreatePanel",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n){var a=this;a.appUser=t,a.banner=n,a.cancel=function(){e.dismiss("cancel")},a.delete=function(){e.close()}},t=function(t,n){return{restrict:"A",scope:{appUser:"<",banner:"=",confirmFunc:"&?"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"banner/bannerDeleteConfirmBtn.html",controller:["$uibModalInstance","appUser","banner",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},banner:function(){return a.banner}}}).result.then(function(){"function"==typeof a.confirmFunc&&"function"==typeof a.confirmFunc()&&a.confirmFunc()()})})}}};angular.module("shmApp.directives").directive("bannerDeleteConfirmBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.company=n,o.cancel=function(){e.dismiss("cancel")},o.delete=function(){return o.company_name&&""!==o.company_name?o.company_name!==o.company.name?void(o.deletingErr={message:i.instant("COMPANY.DELETE.ERROR.NAME_DIFFERENT")}):(o.deleting=!0,o.deletingErr=void 0,void a.deactivateCompany(o.company.id).then(function(t){e.close(t.data)},function(e){o.deletingErr=e.data}).finally(function(){o.deleting=void 0})):void(o.deletingErr={message:i.instant("COMPANY.DELETE.ERROR.NAME_REQUIRED")})}},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},link:function(o,r,s){r.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"company/companyDeleteConfirmPanel.html",controller:["$uibModalInstance","appUser","company","CompanyService","$translate",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return o.appUser},company:function(){return o.company}}}).result.then(function(e){n.setSelectedCompany(e),n.updateCompanyInAllStoredCompanies(e),i.location.reload()})})}}};angular.module("shmApp.directives").directive("companyDeleteBtn",["appConf","UtilsService","$uibModal","$window",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"company/companyEditor.html",link:function(e,t,r){e.enterCompany=function(e){e.currentTarget.blur()},e.saveCompany=function(){var t={};t.company=a.formatCompany(e.appUser,e.company),t.originalCompanyString=JSON.stringify(e.originalCompany),t.companyString=JSON.stringify(t.company),t.companyString!==t.originalCompanyString&&(e.savingCompany=!0,e.savingCompanyErr=void 0,"object"==typeof e.company.config&&(t.company.config=JSON.stringify(t.company.config)),"object"==typeof e.company.admin_config&&(t.company.admin_config=JSON.stringify(t.company.admin_config)),n.updateInfo(e.company.id,t.company).then(function(t){e.company=a.formatCompany(e.appUser,t.data),a.setSelectedCompany(e.company),a.updateCompanyInAllStoredCompanies(e.company),e.originalCompany=angular.copy(e.company),i.success(o.instant("COMPANY.SAVED_SUCCESSFULLY"))},function(t){e.savingCompanyErr=t.data,i.error(o.instant(e.savingCompanyErr.message))}).finally(function(){e.savingCompany=void 0}))},e.company=a.formatCompany(e.appUser,e.company),e.canAccess=!0===e.company.isCurrentUserAdmin||!0===e.appUser.is_admin,e.originalCompany=angular.copy(e.company)}}};angular.module("shmApp.directives").directive("companyEditor",["appConf","$rootScope","CompanyService","UtilsService","toastr","$translate",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{companyExpiredInfoPanel:"<"},link:function(e,i,o){var r={};e.appUser=t.appUser,e.company=n.formatCompany(e.appUser,e.companyExpiredInfoPanel),!0===e.company.is_expired&&(r.html='<div class="company-expired-info-panel-wrapper"><div class="alert alert-danger company-expired-info-panel"><div class="text-center"><strong translate="COMPANY.EXPIRED.INFO.PANEL.BODY" translate-values="{\'company_name\': company.name, \'expired_at\': (company.admin_config.currentPackageExpireDate | amUtc | amLocal | amDateFormat: \'ll\')}"></strong></div><ask-customer-service-panel></ask-customer-service-panel></div></div>',r.newElement=a(r.html)(e),i.replaceWith(r.newElement))}}};angular.module("shmApp.directives").directive("companyExpiredInfoPanel",["appConf","$rootScope","UtilsService","$compile",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"A",scope:{companyNotHaveThisModuleInfoPanel:"<",moduleName:"@"},link:function(e,i,o){var r={};e.appUser=t.appUser,e.company=n.formatCompany(e.appUser,e.companyNotHaveThisModuleInfoPanel),e.company.modules[e.moduleName.toLowerCase()]&&e.company.modules[e.moduleName.toLowerCase()].create&&!0===e.company.modules[e.moduleName.toLowerCase()].create||(r.html='<div class="company-not-have-this-module-info-panel-wrapper"><div class="alert alert-warning company-not-have-this-module-info-panel"><div class="text-center"><strong translate="COMPANY.NOT_HAVING_THIS_MODULE.INFO.PANEL.BODY" translate-values="{\'company_name\': company.name, \'module_name\': (moduleName.toUpperCase() | translate)}"></strong></div><ask-customer-service-panel ng-if="appUser.is_admin !== true" btn-text="{{\'CUSTOMER_SERVICE.CLICK_HERE_TO_ENABLE_THIS_MODULE\' | translate}}"></ask-customer-service-panel></div></div>',r.newElement=a(r.html)(e),!0===e.appUser.is_admin?i.prepend(r.newElement):i.replaceWith(r.newElement))}}};angular.module("shmApp.directives").directive("companyNotHaveThisModuleInfoPanel",["appConf","$rootScope","UtilsService","$compile",e])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<",cancelFunc:"&?",saveSuccessFunc:"&?",pickupLocation:"<?"},templateUrl:e.rootDir.views+"company/companyPickupLocationEdit.html",link:function(e,o,r){if(e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.save=function(){var n={};e.saving=!0,e.savingErr=void 0,n.saveFunc=e.pickupLocation&&e.pickupLocation.id?t.updateCompanyPickupLocation(e.company.id,e.pickupLocation.id,e.pickupLocation):t.createCompanyPickupLocation(e.company.id,e.pickupLocation),n.saveFunc.then(function(t){e.pickupLocation=t.data,"function"==typeof e.saveSuccessFunc&&"function"==typeof e.saveSuccessFunc()&&e.saveSuccessFunc()(e.pickupLocation)},function(t){e.savingErr=t.data}).finally(function(){e.saving=void 0})},e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.company=n.formatCompany(e.appUser,e.company),!0!==i.appUser.is_admin)if(!0!==e.company.isCompanyAdmin)o.remove();else if(!0===e.company.is_expired){var s=angular.element("<ask-customer-service-panel title=\"{{'COMPANY_EXPIRED' | translate}}\" btn-text=\"{{'CUSTOMER_SERVICE.CLICK_HERE_TO_EXTEND_EXPIRY_DATE' | translate}}\"></ask-customer-service-panel>");a(s)(e),o.replaceWith(s)}else if(e.company.modules&&e.company.modules.group_buy&&!0!==e.company.modules.group_buy.pickup_location&&(!e.pickupLocation||!e.pickupLocation.id)){var s=angular.element("<ask-customer-service-panel title=\"{{'SORRY_THIS_MODULE_IS_NOT_ENABLED' | translate}}\" btn-text=\"{{'CUSTOMER_SERVICE.CLICK_HERE_TO_ENABLE_THIS_MODULE' | translate}}\"></ask-customer-service-panel>");a(s)(e),o.replaceWith(s)}}}};angular.module("shmApp.directives").directive("companyPickupLocationEdit",["appConf","CompanyService","UtilsService","$compile","$rootScope",e])}(),function(){"use strict";var e,t=function(t,n,a,i){e=this,e.company=a,e.pickupLocation=n,e.cancel=function(){t.dismiss("cancel")},e.deletePickupLocation=function(){e.deleting=!0,e.deletingErr=void 0,i.deleteCompanyPickupLocation(e.company.id,e.pickupLocation.id).then(function(e){t.close(e.data&&e.data.success&&!0===e.data.success)},function(t){e.deletingErr=t.data}).finally(function(){e.deleting=void 0})}},n=function(e,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<",hideTitle:"<?"},templateUrl:e.rootDir.views+"company/companyPickupLocations.html",link:function(o,r,s){o.getPickupLocations=function(){o.gettingLocations=!0,o.gettingLocationsErr=void 0,n.getCompanyPickupLocations(o.company.id).then(function(e){o.locationList=e.data},function(e){o.gettingLocationsErr=e.data}).finally(function(){o.gettingLocations=void 0})},o.showNewLocationPanel=function(){o.addingNewLocation=!0},o.hideNewLocationPanel=function(){o.addingNewLocation=void 0},o.showEditPanel=function(e){angular.forEach(o.locationList,function(e){e.editing=void 0}),o.locationList&&o.locationList[e]&&(o.locationList[e].editing=!0)},o.hideEditPanel=function(){angular.forEach(o.locationList,function(e){!0===e.editing&&(e.editing=void 0)})},o.confirmDelete=function(n){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.rootDir.views+"company/confirmDeletePickupLocation.html",controller:["$uibModalInstance","pickupLocation","company","CompanyService",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{pickupLocation:function(){return o.locationList[n]},company:function(){return o.company}}}).result.then(function(e){!0===e&&(o.locationList[n].active=0)})},o.getPickupLocations(),o.company=a.formatCompany(o.appUser,o.company),o.canCreate=!0===o.company.isCompanyAdmin&&!0!==o.company.is_expired||!0===o.appUser.is_admin}}};angular.module("shmApp.directives").directive("companyPickupLocations",["appConf","CompanyService","UtilsService","$uibModal",n])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.appUser=t,i.company=n,i.cancel=function(){e.dismiss("cancel")},i.getQrCodes=function(){i.totalQrCodes=0,i.getting=!0,i.gettingErr=void 0,a.getCompanyQrcodes(i.company.id).then(function(e){i.qrcodes=e.data,angular.forEach(i.qrcodes,function(e,t){e&&null!==e&&""!==e?i.totalQrCodes=1*i.totalQrCodes+1:delete i.qrcodes[t]})},function(e){i.gettingErr=e.data}).finally(function(){i.getting=void 0})},i.getQrCodes()},t=function(t,n){return{restrict:"AE",scope:{appUser:"<",company:"<"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"company/companyQrCodePanel.html",controller:["$uibModalInstance","appUser","company","CompanyService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},company:function(){return a.company}}})})}}};angular.module("shmApp.directives").directive("companyQrCodePopupBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.company=n,r.steps={companyInfoUpdated:void 0,companyEnablePaymentMethods:void 0},r.finishedAllSteps=!1,r.cancel=function(){e.dismiss("cancel")},r.close=function(t){e.close(t)},r.checkAllStepsFinished=function(){return angular.forEach(r.steps,function(e,t){console.log(t)}),r},r.updateCompanyInfo=function(){if(!r.company.name||""===r.company.name)return void(r.savingErr={message:i.instant("COMPANY.NAME.IS_REQUIRED"),errors:{name:[i.instant("COMPANY.NAME.IS_REQUIRED")]}});var e={};return e.company=o.formatCompany(r.appUser,r.company),"object"==typeof r.company.config&&(e.company.config=JSON.stringify(e.company.config)),"object"==typeof r.company.admin_config&&(e.company.admin_config=JSON.stringify(e.company.admin_config)),r.saving=!0,r.savingErr=void 0,a.updateInfo(e.company.id,e.company).then(function(e){r.company=e.data,r.steps.companyInfoUpdated=!0,r.checkAllStepsFinished()},function(e){r.savingErr=e.data}).finally(function(){r.saving=void 0}),r}},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},link:function(o,r,s){o.appUser&&o.appUser.id&&""!==o.appUser.id&&o.company&&o.company.id&&""!==o.company.id&&!1===o.company.has_been_setup&&(!0===o.company.isCompanyAdmin||!0===o.company.isCurrentUserAdmin)&&a.open({animation:!0,templateUrl:t.rootDir.views+"company/companySetupGuidePanel.html",controller:["$uibModalInstance","appUser","company","CompanyService","$translate","UtilsService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return o.appUser},company:function(){return o.company}}}).result.then(function(e){n.setSelectedCompany(e),n.updateCompanyInAllStoredCompanies(e),i.location.reload()})}}}
;angular.module("shmApp.directives").directive("companySetupGuidePanel",["appConf","UtilsService","$uibModal","$window",t])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"="},templateUrl:e.rootDir.views+"company/companySuperAdminPanel.html",link:function(e,t,n){e.packageList=[{type:"normal",name:"PACKAGE.SELECTION.NORMAL_PACKAGE"},{type:"recommendation",name:"PACKAGE.SELECTION.RECOMMENDED_PACKAGE"},{type:"professional",name:"PACKAGE.SELECTION.PROFESSIONAL_PACKAGE"},{type:"none",name:"PACKAGE.SELECTION.NONE_PACKAGE"}]}}};angular.module("shmApp.directives").directive("companySuperAdminPanel",["appConf","$translate",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",optionsPosition:"@?"},templateUrl:e.rootDir.views+"company/companySwitch.html",link:function(e,n,o){e.switch=function(e){i.setSelectedCompany(e),a.go("backend.dashboard",{},{reload:!0})},e.getAllCompanies=function(){e.getting=!0,e.gettingErr=void 0,t.getAllCompanies().then(function(t){e.companyOptions=t.data,i.setAllStoredCompanies(e.companyOptions)},function(t){e.gettingErr=t.data}).finally(function(){e.getting=void 0})},e.showCompanyOptions=function(){!0===e.appUser.is_admin&&(e.companyOptions=i.getAllStoredCompanies())},e.searchObject={text:""},e.optionsPosition=e.optionsPosition||"bottom",e.companyOptions=e.appUser.userCompany,!0===e.appUser.is_admin&&(e.companyOptions=i.getAllStoredCompanies(),e.companyOptions&&0!==e.companyOptions.length||e.getAllCompanies())}}};angular.module("shmApp.directives").directive("companySwitch",["appConf","CompanyService","$rootScope","$state","UtilsService","$timeout",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"A",scope:{notCompanyAdminPanel:"<",appUser:"<?"},link:function(t,i,o){var r={};t.appUser=t.appUser||e.appUser,t.company=n.formatCompany(t.appUser,t.notCompanyAdminPanel),!0!==t.company.isCurrentUserAdmin&&!0!==e.appUser.is_admin&&(r.html='<div class="not-company-admin-panel-wrapper"><div class="title" translate="ACCESS_DENY"></div><div class="body"><div translate="YOU_ARE_NOT_THE_COMPANY_ADMIN" translate-values="{\'company_name\': company.name}"></div></div></div>',r.newElement=a(r.html)(t),i.replaceWith(r.newElement))}}};angular.module("shmApp.directives").directive("notCompanyAdminPanel",["$rootScope","appConf","UtilsService","$compile",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"dashboard/dashboard.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("dashboard",["appConf","CompanyService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"groupBuy/groupBuyList.html",link:function(n,a,i){n.getItems=function(a){var i={page:a||1};i.params={"page-size":n.pageSize,page:i.page,"key-word":n.searchObj.text,community_id:e.community.group_buy.id},i.params=angular.merge({},i.params,n.searchTypes[n.searchObj.selected_type]),n.gettingErr=void 0,n.gettingMoreErr=void 0,i.page>1?n.gettingMore=!0:n.getting=!0,t.searchItemsUnderCompanyOnlyForGroupBuy(n.company.id,i.params).then(function(e){n.itemList&&n.itemList.data&&n.itemList.data.length>0&&i.page>1?(i.previousData=n.itemList.data,n.itemList=e.data,n.itemList.data=i.previousData.concat(e.data.data)):n.itemList=e.data},function(e){i.page>1?n.gettingMoreErr=e.data:n.gettingErr=e.data}).finally(function(){n.getting=void 0,n.gettingMore=void 0})},n.switchType=function(e){n.searchObj.selected_type=e,n.getItems()},n.pageSize=n.pageSize?n.pageSize:12,n.searchTypes={available:{is_draft:0,is_ended:0,is_expired:0,is_published:1,is_sold:0},ended:{is_expired:1,is_draft:0},all:{}},n.searchObj={text:"",selected_type:Object.keys(n.searchTypes)[0]},n.getItems()}}};angular.module("shmApp.directives").directive("groupBuyList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:e.rootDir.views+"groupBuy/groupBuyListItem.html",link:function(e,t,n){e.item.title=e.item.title.replace(" ","")}}};angular.module("shmApp.directives").directive("groupBuyListItem",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",itemId:"<",company:"<",cancelFunc:"&?"},templateUrl:e.rootDir.views+"groupBuy/groupBuyDetails.html",link:function(e,a,i){e.getGroupBuyItemDetails=function(){e.loadingDetails=!0,e.loadingDetailsErr=void 0,t.getItemDetails(e.itemId).then(function(t){e.itemDetails=t.data,e.itemDetails.date_expiry=moment(moment.utc(e.itemDetails.date_expiry)).local().format("YYYY-MM-DD HH:mm:ss"),n.editingGroupbuy=e.itemDetails},function(t){e.loadingDetailsErr=t.data}).finally(function(){e.loadingDetails=void 0})},e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.itemSaved=function(e){o.go("backend.group_buys_details",{id:e.id},{reload:!0})},e.startDateBeforeRender=function(e){var t=new Date,n=new Date(t);n.setDate(t.getDate()+1),n.setUTCHours(0,0,0,0),e.filter(function(e){return e.utcDateValue<n.getTime()}).forEach(function(e){e.selectable=!1})},e.deleteBonus=function(t){switch(t){case e.bonusTypeList.participate:e.itemDetails.jielong_success_entities=[];break;case e.bonusTypeList.share:e.itemDetails.wxshare_success_entities=[]}},e.itemId?e.getGroupBuyItemDetails():e.itemDetails={},e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.hasExpireDate=!1,e.bonusTypeList={share:{name:"SHARE"},participate:{name:"PARTICIPATE"}},e.jielongVoucherEntityMap={voucher_group:"App\\Modules\\Platform\\Models\\CompanyVoucherGroup",voucher_campaign:"App\\Modules\\Platform\\Models\\VoucherCampaign"}}}};angular.module("shmApp.directives").directive("groupBuyDetails",["appConf","ItemService","$rootScope","$uibModal","$translate","$state",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.company=n,r.selectedEntities=angular.copy(a),r.bonusType=i,r.cancel=function(){e.dismiss("cancel")},r.add=function(){void 0==r.selectedEntities[0]&&(r.selectedEntities=[]),e.close(r.selectedEntities)},r.getVoucherList=function(e){var t={page:e||1};t.params={"page-size":12,page:t.page,available:1},r.searchObject&&r.searchObject.text&&""!=r.searchObject.text&&(t.params["key-word"]=r.searchObject.text),r._getVoucherList(e,t.params)},r._getVoucherList=function(e,t){var n={page:e};r.gettingErr=void 0,r.gettingMoreErr=void 0,n.page>1?r.gettingMore=!0:r.getting=!0,o.getVoucherGroupsUnderCompany(r.company.id,t).then(function(e){r.itemList&&r.itemList.data&&r.itemList.data.length>0&&n.page>1?(n.previousData=r.itemList.data,r.itemList=e.data,r.itemList.data=n.previousData.concat(e.data.data)):r.itemList=e.data},function(e){n.page>1?r.gettingMoreErr=e.data:r.gettingErr=e.data}).finally(function(){r.getting=void 0,r.gettingMore=void 0})},r.jielongVoucherEntityMap={voucher_group:"App\\Modules\\Platform\\Models\\CompanyVoucherGroup",voucher_campaign:"App\\Modules\\Platform\\Models\\VoucherCampaign"},r.getVoucherList()},t=function(t,n){return{restrict:"AE",scope:{appUser:"<",company:"<",selectedEntities:"=?",bonusType:"=?"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"groupBuy/groupBuyVoucherSelector.html",controller:["$uibModalInstance","appUser","company","selectedEntities","bonusType","CompanyService",e],controllerAs:"mdCtrl",size:"lg",resolve:{appUser:function(){return a.appUser},company:function(){return a.company},selectedEntities:function(){return a.selectedEntities},bonusType:function(){return a.bonusType}}}).result.then(function(e){a.selectedEntities=e})})}}};angular.module("shmApp.directives").directive("groupBuyVoucherSelector",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{appUser:"<",bonusEntities:"=?",bonusType:"<?",company:"<?"},templateUrl:e.rootDir.views+"groupBuy/groupBuyVoucherPreview.html",link:function(e,t,n){e.deleteBonus=function(){e.bonusEntities=[]}}}};angular.module("shmApp.directives").directive("groupBuyVoucherPreview",["appConf",e])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.item=n,o.itemType=a,o.cancel=function(){e.dismiss("cancel")},o.delete=function(){o.deleting=!0,o.deletingErr=void 0,i.markItemDeactivate(o.item.id).then(function(t){e.close(t.data)},function(e){o.deletingErr=e.data}).finally(function(){o.deleting=void 0})}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",itemDeleteBtn:"=",succFunc:"&?",itemType:"@?"},link:function(i,o,r){o.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmDelete.html",controller:["$uibModalInstance","appUser","item","itemType","ItemService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return i.appUser},item:function(){return i.itemDeleteBtn},itemType:function(){return i.itemType}}}).result.then(function(e){i.item=n.formatItem(e),"function"==typeof i.succFunc&&"function"==typeof i.succFunc()&&i.succFunc()(i.item)})})}}};angular.module("shmApp.directives").directive("itemDeleteBtn",["appConf","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i){var o=this;o.appUser=t,o.item=n,o.itemType=a,o.cancel=function(){e.dismiss("cancel")},o.save=function(){o.saving=!0,o.savingErr=void 0,i.markItemEnd(o.item.id).then(function(t){e.close(t.data)},function(e){o.savingErr=e.data}).finally(function(){o.saving=void 0})}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",itemEndBtn:"=",succFunc:"&?",itemType:"@?"},link:function(i,o,r){o.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmEnd.html",controller:["$uibModalInstance","appUser","item","itemType","ItemService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return i.appUser},item:function(){return i.itemEndBtn},itemType:function(){return i.itemType}}}).result.then(function(e){i.item=n.formatItem(e),"function"==typeof i.succFunc&&"function"==typeof i.succFunc()&&i.succFunc()(i.item)})})}}};angular.module("shmApp.directives").directive("itemEndBtn",["appConf","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{appUser:"<",item:"=",succFunc:"&?",itemType:"@?"},templateUrl:e.rootDir.views+"item/optionBtns.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("itemOptionBtns",["appConf","UtilsService","$uibModal",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.item=n,r.itemType=a,r.cancel=function(){e.dismiss("cancel")},r.save=function(){r.item.is_draft=!1,r.item.is_sync_to_market=!r.item.is_draft,r.item.date_publish=o.getNowUtcDateTime().format("YYYY-MM-DD HH:m:ss"),"object"==typeof r.item.config&&(r.item.config=JSON.stringify(r.item.config)),r.saving=!0,r.savingErr=void 0,i.updateItem(r.item.id,r.item).then(function(t){e.close(t.data)},function(e){r.savingErr=e.data}).finally(function(){r.saving=void 0})}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",itemPublishBtn:"=",succFunc:"&?",itemType:"@?"},link:function(i,o,r){o.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmPublish.html",controller:["$uibModalInstance","appUser","item","itemType","ItemService","UtilsService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return i.appUser},item:function(){return i.itemPublishBtn},itemType:function(){return i.itemType}}}).result.then(function(e){i.item=n.formatItem(e),"function"==typeof i.succFunc&&"function"==typeof i.succFunc()&&i.succFunc()(i.item)})})}}};angular.module("shmApp.directives").directive("itemPublishBtn",["appConf","UtilsService","$uibModal",t])}(),function(){"use strict";var e=function(e){return{restrict:"A",scope:{itemQrCodePanel:"<",title:"@?"},template:'<div class="item-qr-codes-wrapper"><loading-bar ng-if="getting === true"></loading-bar><div ng-if="getting !== true" class="text-center"><show-error-from-json error-obj="gettingErr"></show-error-from-json><div translate="ITEM.PREVIEW.QRCODE.BODY" ng-if="!title"></div><h3 ng-if="title" ng-bind-html="title"></h3><div class="item-qrcodes-list qrcode-list text-center row" ng-if="!gettingErr"><div class="qrcode-list-item {{key}} text-center ngClass:{\'col-md-12\': totalQrCodes <= 1, \'col-md-6\': totalQrCodes > 1}" ng-repeat="(key, url) in qrcodes"><img ng-src="{{url}}" class="img-responsive qrcode-img"/></div></div></div></div>',link:function(t,n,a){t.getQrCodes=function(){t.totalQrCodes=0,t.getting=!0,t.gettingErr=void 0,e.getItemQrCodes(t.item.id).then(function(e){t.qrcodes=e.data,angular.forEach(t.qrcodes,function(e,n){e&&null!==e&&""!==e?t.totalQrCodes=1*t.totalQrCodes+1:delete t.qrcodes[n]})},function(e){t.gettingErr=e.data}).finally(function(){t.getting=void 0})},t.item=t.itemQrCodePanel,t.getQrCodes()}}};angular.module("shmApp.directives").directive("itemQrCodePanel",["ItemService",e])}(),function(){"use strict";var e=function(e,t){var n=this;n.item=t,n.cancel=function(){e.dismiss("cancel")}},t=function(t){return{restrict:"A",scope:{itemQrCodePopupBtn:"<"},link:function(n,a){a.on("click",function(){t.open({animation:!0,template:'<div class="item-qrcodes-wrapper"><div class="modal-header"><div class="modal-title" translate="ITEM.PREVIEW.QRCODE.TITLE"></div></div><div class="modal-body"><div item-qr-code-panel="mdCtrl.item"></div></div><div class="modal-footer text-center"><button type="button" class="btn btn-success" translate="OK" ng-click="mdCtrl.cancel()"></button></div></div>',controller:["$uibModalInstance","item",e],controllerAs:"mdCtrl",resolve:{item:function(){return n.itemQrCodePopupBtn}}})})}}};angular.module("shmApp.directives").directive("itemQrCodePopupBtn",["$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o,r,s,c,u){var p=this;p.appUser=n,p.item=a,p.itemType=r,p.company=o,p.preCheckingErr=i,p.cancel=function(){t.dismiss("cancel")},p.close=function(){t.close(p.item)},p.save=function(t){var n={};p.item.is_draft=t||!1,p.item.is_sync_to_market=!p.item.is_draft,p.item.multi_participations=!1,p.item.date_expiry&&null!=p.item.date_expiry?p.item.date_expiry=moment(p.item.date_expiry).format("YYYY-MM-DD HH:mm:ss"):(n.maxUtcDateTime=u.getMaxUtcDateTime(),p.item.date_expiry=n.maxUtcDateTime.format("YYYY-MM-DD HH:mm:ss")),p.item.date_publish=u.getNowUtcDateTime().format("YYYY-MM-DD HH:mm:ss"),p.item.address||(p.item.address=u.getDefaultAddressObj()),p.item.tagNames&&0!=p.item.tagNames.length||(p.item.tagNames=[e.community[s].name]),p.item.id&&""!=p.item.id||(p.item.company_id=p.company.id),"object"==typeof p.item.config&&(p.item.config=JSON.stringify(p.item.config)),n.savingFunc=p.item.id&&""!==p.item.id?c.updateItem(p.item.id,p.item):c.createItem(p.item),p.saving=!0,p.savingErr=void 0,p.savingSuccess=void 0,n.savingFunc.then(function(e){p.item=u.formatItem(e.data),p.savingSuccess=!0},function(e){p.savingErr=e.data}).finally(function(){p.saving=void 0})}},t=function(t,n,a,i,o){return{restrict:"A",scope:{appUser:"<",company:"<",communityType:"@",itemSaveBtn:"=",succFunc:"&?",itemType:"@?",getPreCheckErrFunc:"&?"},link:function(r,s,c){r.item=r.itemSaveBtn,s.on("click",function(){a.open({animation:!0,templateUrl:t.rootDir.views+"item/confirmSave.html",controller:["appConf","$uibModalInstance","appUser","item","preCheckingErr","company","itemType","communityType","ItemService","UtilsService",e],controllerAs:"mdCtrl",backdrop:"static",keyboard:!1,resolve:{appUser:function(){return r.appUser},item:function(){return r.item},company:function(){return r.company},itemType:function(){return r.itemType},communityType:function(){return r.communityType},preCheckingErr:function(){if("function"==typeof r.getPreCheckErrFunc&&"function"==typeof r.getPreCheckErrFunc())return r.getPreCheckErrFunc()(r.item)}}}).result.then(function(e){r.item.id&&""!==r.item.id?i.success(o.instant("ITEM.UPDATE.SUCCESSFULLY")):i.success(o.instant("ITEM.CREATE.SUCCESSFULLY")),r.item=n.formatItem(e),"function"==typeof r.succFunc&&"function"==typeof r.succFunc()&&r.succFunc()(r.item)})})}}};angular.module("shmApp.directives").directive("itemSaveBtn",["appConf","UtilsService","$uibModal","toastr","$translate",t])}(),function(){"use strict";var e=function(e){return{restrict:"A",scope:{showItemWithStatus:"<"},link:function(t,n,a){t.item=t.showItemWithStatus,n.addClass("item-with-status"),n.addClass("item-with-status-"+e.getItemStatusName(t.item).toLowerCase())}}};angular.module("shmApp.directives").directive("showItemWithStatus",["ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.rootDir.views+"language/languageSwitch.html",link:function(e,n,o){e.toggleDisplayOptions=function(){e.displayOptions=!0!==e.displayOptions},e.hideOptions=function(){e.displayOptions=!1},e.switch=function(t){i.switchLanguage(t),e.selectedLanguage=t,e.hideOptions()},e.selectedLanguage=t.use(),e.languages=i.getSupportedLanguages(),a.search().lang&&""!==a.search().lang?e.switch(a.search().lang):""!==i.getLocalLanguageKey()&&e.switch(i.getLocalLanguageKey())}}};angular.module("shmApp.directives").directive("languageSwitch",["appConf","$translate","amMoment","$location","LanguageService",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.rootDir.views+"login/loginPanel.html",link:function(e,i,o){e.getCurrentUser=function(){e.gettingCurrentUser=!0,e.gettingCurrentUserErr=void 0,n.getMe().then(function(n){if(n.data&&n.data.id){t.appUser=e.appUser=n.data;var i=a.getSelectedCompany();i&&i.id||(i=t.appUser.userCompany[0]),a.setSelectedCompany(i)}},function(t){e.gettingCurrentUserErr=void 0}).finally(function(){e.gettingCurrentUser=!1})},e.appUser={},e.getCurrentUser()}}};angular.module("shmApp.directives").directive("loginPanel",["appConf","$rootScope","AuthService","UtilsService",e])}(),function(){"use strict";var e=function(e,t,n,a,i){return{restrict:"AE",scope:{},templateUrl:e.rootDir.views+"login/weChatLoginQrPanel.html",link:function(e,o,r){e.navToDashboard=function(){t.go("backend.dashboard",{},{reload:!0})},e.loginWithToken=function(t){e.loggedIn=void 0,e.loggingIn=!0,e.loggingInErr=void 0,n.loginWithTempCode(t).then(function(t){t.data&&t.data.return_code&&(i.cancel(e.loginStatusChecker),a.setToken(t.data.return_code),e.loggedIn=!0,e.navToDashboard())},function(t){e.loggingInErr=t.data}).finally(function(){e.loggingIn=void 0})},e.getLoginStatus=function(){e.gotLoginStatus=void 0,e.gettingLoginStatus=!0,e.gettingLoginStatusErr=void 0,n.checkLoginStatus(e.loginObj.subscribeLoginLogId).then(function(t){t.data&&t.data.log&&t.data.log.tmp_token&&""!==t.data.log.tmp_token&&(i.cancel(e.loginStatusChecker),e.gotLoginStatus=!0,e.loginWithToken(t.data.log.tmp_token))},function(t){e.gettingLoginStatusErr=t.data}).finally(function(){e.gettingLoginStatus=void 0})},e.startGetLoginStatus=function(){e.loginStatusCheckerTimes=0,e.loginStatusChecker=i(function(){e.getLoginStatus(),e.loginStatusCheckerTimes+=1,e.loginStatusCheckerTimes>e.loginStatusCheckerMaxTimes&&i.cancel(e.loginStatusChecker)},e.loginStatusCheckerInterval)},e.getQrCodeUrl=function(){return e.loadingWechatLoginUrl=!0,e.loadingWechatLoginUrlErr=void 0,n.generateLoginQrCode().then(function(t){e.loginObj=t.data,e.startGetLoginStatus()},function(t){e.loadingWechatLoginUrlErr=t.data}).finally(function(){e.loadingWechatLoginUrl=!1}),e},e.getQrCodeUrl(),e.loginStatusCheckerTimes=0,e.loginStatusCheckerMaxTimes=5e3,e.loginStatusCheckerInterval=1e3}}};angular.module("shmApp.directives").directive("weChatLoginQrPanel",["appConf","$state","AuthService","$auth","$interval",e])}(),function(){"use strict";var e,t,n,a=function(a,i,o){return e=a,t=i,n=o,{restrict:"AE",scope:{},template:"<loading-bar></loading-bar>",link:function(a){e.setToken(t.params.token),t.params.origurl?n.location.href=decodeURIComponent(t.params.origurl):t.go("backend.dashboard",{},{reload:!0})}}};angular.module("shmApp.directives").directive("loginFromToken",["$auth","$state","$window",a])}(),function(){"use strict";var e=function(e,t,n,a,i,o,r){return{restrict:"AE",scope:{appUser:"<",company:"<",item:"=?",cancelFunc:"&?",itemLoadedFunc:"&?",succFunc:"&?"},templateUrl:e.rootDir.views+"note/noteDetailsEditPanel.html",link:function(e,s,c){e.getCompanyTags=function(){e.gettingTags=!0,e.gettingDetailsErr=void 0,r.getCompanyTags(e.company.id).then(function(t){e.companyTags=t.data&&t.data.length>0?_.pluck(t.data,"name"):[]},function(t){e.gettingTagsErr=t.data}).finally(function(){e.gettingTags=void 0})},e.getItemDetails=function(a){e.gettingDetails=!0,e.gettingDetailsErr=void 0,t.getItemDetails(e.item.id).then(function(t){e.item=n.formatItem(t.data),"function"==typeof a&&a(e.item)},function(t){e.gettingDetailsErr=t.data}).finally(function(){e.gettingDetails=void 0})},e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.getWhetherToShowCompanyContactInfo=function(){return a.selectedCompany.config&&a.selectedCompany.config.defaultContact&&""!==a.selectedCompany.config.defaultContact},e.itemSaved=function(e){i.go("backend.notes_details",{id:e.id},{reload:!0})},e.preSaveCheck=function(e){if(!e.title||""===e.title)return n.getErrorMsgObj(o.instant("NOTE.TITLE.IS_REQUIRED"))},e.company&&e.company.id&&e.getCompanyTags(),e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.item=e.item||{images:[],config:{ifShowCompanyContact:e.getWhetherToShowCompanyContactInfo()}},e.canEdit=!0===e.company.isCompanyAdmin&&!0!==e.company.is_expired||!0===e.appUser.is_admin,e.item.id&&""!==e.item.id&&e.getItemDetails(function(t){e.canEdit=0!==parseInt(e.item.active)&&!0===e.canEdit,"function"==typeof e.itemLoadedFunc&&"function"==typeof e.itemLoadedFunc()&&e.itemLoadedFunc()(t)})}}};angular.module("shmApp.directives").directive("noteDetailsEditPanel",["appConf","ItemService","UtilsService","$rootScope","$state","$translate","CompanyService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"note/noteList.html",link:function(n,a,i){n.switchType=function(e){n.searchObj.selected_type=e,n.getItems()},n.getItems=function(a){var i={page:a||1};i.params={"page-size":n.pageSize,page:i.page,"key-word":n.searchObj.text,community_id:e.community.note.id},i.params=angular.merge({},i.params,n.searchTypes[n.searchObj.selected_type]),n.gettingErr=void 0,n.gettingMoreErr=void 0,i.page>1?n.gettingMore=!0:n.getting=!0,t.searchItemsUnderCompany(n.company.id,i.params).then(function(e){n.itemList&&n.itemList.data&&n.itemList.data.length>0&&i.page>1?(i.previousData=n.itemList.data,n.itemList=e.data,n.itemList.data=i.previousData.concat(e.data.data)):n.itemList=e.data},function(e){i.page>1?n.gettingMoreErr=e.data:n.gettingErr=e.data}).finally(function(){n.getting=void 0,n.gettingMore=void 0})},n.pageSize=n.pageSize?n.pageSize:12,n.searchTypes={published:{is_published:1,is_draft:0,is_ended:0},draft:{is_published:0,is_draft:1},ended:{is_published:0,is_ended:1},all:{}},n.searchObj={text:"",selected_type:Object.keys(n.searchTypes)[0]},n.getItems()}}};angular.module("shmApp.directives").directive("noteList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:e.rootDir.views+"note/noteGridItem.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("noteGridItem",["appConf","UtilsService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"product/productList.html",link:function(n,a,i){n.getItems=function(a){var i={page:a||1};i.params={"page-size":n.pageSize,page:i.page,"key-word":n.searchObj.text,community_id:e.community.note.id},i.params=angular.merge({},i.params,n.searchTypes[n.searchObj.selected_type]),n.gettingErr=void 0,n.gettingMoreErr=void 0,i.page>1?n.gettingMore=!0:n.getting=!0,t.searchItemsUnderCompanyOnlyForProduct(n.company.id,i.params).then(function(e){n.itemList&&n.itemList.data&&n.itemList.data.length>0&&i.page>1?(i.previousData=n.itemList.data,n.itemList=e.data,n.itemList.data=i.previousData.concat(e.data.data)):n.itemList=e.data},function(e){i.page>1?n.gettingMoreErr=e.data:n.gettingErr=e.data}).finally(function(){n.getting=void 0,n.gettingMore=void 0})},n.switchType=function(e){n.searchObj.selected_type=e,n.getItems()},n.pageSize=n.pageSize?n.pageSize:12,n.searchTypes={selling:{is_draft:0,is_expired:0,is_sold:0},sold:{is_sold:1},expired:{is_expired:1,is_sold:0,is_draft:0},draft:{is_draft:1},all:{}},n.searchObj={text:"",selected_type:Object.keys(n.searchTypes)[0]},n.getItems()}}};angular.module("shmApp.directives").directive("productList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:e.rootDir.views+"product/productGridItem.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("productGridItem",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<",item:"=?",cancelFunc:"&?",itemLoadedFunc:"&?",succFunc:"&?"},templateUrl:e.rootDir.views+"product/productDetails.html",link:function(e,a,r){e.getItemDetails=function(a){e.gettingDetails=!0,e.gettingDetailsErr=void 0,t.getItemDetails(e.item.id).then(function(t){e.item=n.formatItem(t.data),"function"==typeof a&&a(e.item)},function(t){e.gettingDetailsErr=t.data}).finally(function(){e.gettingDetails=void 0})},e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.itemSaved=function(e){i.go("backend.product_details",{id:e.id},{reload:!0})},e.preSaveCheck=function(e){return e.title&&""!==e.title?e.price&&""!==e.price?void 0:n.getErrorMsgObj(o.instant("PRODUCT.PRICE.IS_REQUIRED")):n.getErrorMsgObj(o.instant("PRODUCT.TITLE.IS_REQUIRED"))},e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.item=e.item||{images:[],config:{}},e.isSameCompany=!1,e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.item.id&&""!==e.item.id&&e.getItemDetails(function(t){e.canEdit=0!==parseInt(e.item.active)&&!0===e.canEdit,"function"==typeof e.itemLoadedFunc&&"function"==typeof e.itemLoadedFunc()&&e.itemLoadedFunc()(t)})}}};angular.module("shmApp.directives").directive("productDetails",["appConf","ItemService","UtilsService","$rootScope","$state","$translate",e])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{appUser:"<",item:"=",company:"<",formObj:"="},templateUrl:e.rootDir.views+"product/jielongDetailList.html",link:function(e,a,i){e.addMoreProduct=function(){var t={images:[]};e.item.children.push(t)},e.delete=function(t){e.item.children.splice(t,1)},e.getItemPropertiesTypes=function(){t.getPropertyTypes().then(function(t){e.propertyTypes=t.data},function(t){e.errLoadingPropertyTypes=t.data})},e.getCompanyLocations=function(){n.getCompanyPickupLocations(e.company.id).then(function(t){e.locations=t.data,e.ifSelectLocations=!1})},e.selectAllLocations=function(t,n){e.item.children[t].locations=n?e.locations:[]},e.item.id||(e.item.children=[{images:[]}]),e.canEdit=!0===e.company.isCompanyAdmin||!0===e.appUser.is_admin,e.getItemPropertiesTypes(),e.getCompanyLocations()}}};angular.module("shmApp.directives").directive("jielongDetailList",["appConf","ItemService","CompanyService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<?",succFunc:"&?"},templateUrl:e.rootDir.views+"signUp/signUpPanel.html",link:function(e,r,s){e.loginWithToken=function(t){e.loggingIn=!0,e.loggingInErr=void 0,a.loginWithTempCode(t).then(function(t){t.data&&t.data.return_code&&(n.cancel(e.applicationChecker),i.setToken(t.data.return_code),o.go("backend.dashboard",{},{reload:!0}))},function(t){e.loggingInErr=t.data}).finally(function(){e.loggingIn=void 0})},e.getApplicationStatus=function(){e.gettingApplicationStatus=!0,e.gettingApplicationStatusErr=void 0,t.checkApplicationStatus(e.application.applicationId).then(function(t){t.data&&t.data.shortToken&&""!==t.data.shortToken&&(n.cancel(e.applicationChecker),e.loginWithToken(t.data.shortToken))},function(t){e.gettingApplicationStatusErr=t.data}).finally(function(){e.gettingApplicationStatus=void 0})},e.startGetApplicationStatus=function(){e.applicationCheckerTimes=0,e.applicationChecker=n(function(){e.getApplicationStatus(),e.applicationCheckerTimes+=1,e.applicationCheckerTimes>e.applicationCheckerMaxTimes&&n.cancel(e.applicationChecker)},1e3)},e.preApplyCheck=function(){var n={};n.params=e.newCompany,e.preChecking=!0,e.preCheckingErr=void 0,t.applyCompany(n.params).then(function(t){e.applying=!0,e.application=t.data,e.startGetApplicationStatus()},function(t){e.preCheckingErr=t.data}).finally(function(){e.preChecking=void 0})},e.cancelPreApplyCheck=function(){e.applying=void 0},e.createACompany=function(){e.submitting=!0,e.submittingErr=void 0,t.applyCompany(e.newCompany).then(function(t){"function"==typeof e.succFunc&&"function"==typeof e.succFunc()&&e.succFunc()(t.data)},function(t){e.submittingErr=t.data}).finally(function(){e.submitting=void 0})},e.newCompany={},e.applicationCheckerTimes=0,e.applicationCheckerMaxTimes=5e3}}};angular.module("shmApp.directives").directive("signUpPanel",["appConf","CompanyService","$interval","AuthService","$auth","$state",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<"},templateUrl:e.rootDir.views+"comment/itemCommentList.html",link:function(e,n,a){e.getCommentsForAnItem=function(n){var a={};a.pageNo=n||1,e.gettingItemCommentsErr=void 0,e.gettingMoreItemCommentsErr=void 0,1===a.pageNo?e.gettingItemComments=!0:e.gettingMoreItemComments=!0,t.getCommentsForAnItem(e.item.id).then(function(t){1!==a.pageNo&&(a.previousData=e.itemCommentsList.data),e.itemCommentsList=t.data,1!==a.pageNo&&(e.itemCommentsList.data=a.previousData.concat(e.itemCommentsList.data))},function(t){1===a.pageNo?e.gettingItemCommentsErr=t.data:e.gettingMoreItemCommentsErr=t.data}).finally(function(){e.gettingItemComments=!1,e.gettingMoreItemComments=!1})},e.getCommentsForAnItem()}}};angular.module("shmApp.directives").directive("itemCommentList",["appConf","ItemService",e])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:e.rootDir.views+"staff/staffList.html",link:function(e,i,o){e.searchObject={text:""},e.getItems=function(a){var i={page:a||1};i.params={"page-size":e.pageSize,page:i.page},e.gettingErr=void 0,e.gettingMoreErr=void 0,i.page>1?e.gettingMore=!0:e.getting=!0,t.getUserList(e.company.id,i.params).then(function(t){e.itemList&&e.itemList.data&&e.itemList.data.length>0&&i.page>1?(i.previousData=e.itemList.data,e.itemList.data=t.data.list,e.itemList.data=i.previousData.concat(e.itemList.data)):e.itemList={data:t.data.list,total:t.data.list.length},n.displayCounts=e.itemList.total},function(t){i.page>1?e.gettingMoreErr=t.data:e.gettingErr=t.data}).finally(function(){e.getting=void 0,e.gettingMore=void 0})},e.company=a.formatCompany(e.appUser,e.company),!0!==e.company.isCurrentUserAdmin&&!0!==e.appUser.is_admin||e.getItems()}}};angular.module("shmApp.directives").directive("staffList",["appConf","CompanyService","$rootScope","UtilsService",e])}(),function(){"use strict";var e,t=function(t,n,a,i){e=this,e.staff=n,e.company=a,e.cancel=function(){t.dismiss("cancel")},e.removeUserFromCompany=function(){e.removingUserFromCompany=!0,e.removingUserFromCompanyErr=void 0,i.deleteCompanyUser(e.company.id,e.staff.user.id).then(function(e){t.close(e.data&&e.data.success&&!0===e.data.success)},function(t){e.removingUserFromCompanyErr=t.data}).finally(function(){e.removingUserFromCompany=void 0})}
},n=function(e,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<",staff:"="},templateUrl:e.rootDir.views+"staff/staffListItem.html",link:function(r,s,c){r.changeRole=function(e){!0===r.canChange&&(r.savingStaff=!0,r.savingStaffErr=void 0,n.updateCompanyUser(r.company.id,r.staff.user.id,{is_admin:e}).then(function(t){!0===t.data.success&&(r.staff.role_id=e)},function(e){alert(e.data),r.savingStaffErr=e.data}).finally(function(){r.savingStaff=void 0}))},r.removePending=function(){!0===r.canChange&&!0===r.staff.pending&&(r.savingStaff=!0,r.savingStaffErr=void 0,n.approveCompanyStaff(r.company.id,{user_id:r.staff.user.id}).then(function(e){e.data.id&&e.data.id===r.staff.id&&(r.staff.pending=!1)},function(e){alert(e.data),r.savingStaffErr=e.data}).finally(function(){r.savingStaff=void 0}))},r.confirmRemoveUserFromCompany=function(){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.rootDir.views+"staff/confirmRemoveUserFromCompany.html",controller:["$uibModalInstance","staff","company","CompanyService",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{staff:function(){return r.staff},company:function(){return r.company}}}).result.then(function(e){!0===e&&(r.staff.active=0)})},r.company=i.formatCompany(o.appUser,r.company),r.canChange=(!0===r.company.isCompanyAdmin||!0===o.appUser.is_admin)&&o.appUser.id!==r.staff.user.id}}};angular.module("shmApp.directives").directive("staffListItem",["appConf","CompanyService","$uibModal","UtilsService","$rootScope",n])}(),function(){"use strict";var e,t=function(t,n,a,i,o,r){e=this,e.staff=n,e.company=a,e.genQRCode=function(){e.generatingImg=!0,e.generatingImgErr=void 0,i.genAddUserQRCode(e.company.id).then(function(t){e.qrCodeUrl=t.data},function(t){e.generatingImgErr=t.data}).finally(function(){e.generatingImg=!1})},e.getStaffList=function(){i.getUserList(e.company.id).then(function(t){e.staffList=t.data,e.upperLimit=!(!e.staffList.upper_user_limit||!0!==e.staffList.upper_user_limit)},function(t){e.gettingErr=t.data}).finally(function(){e.getting=void 0})},e.cancel=function(){t.dismiss("cancel")},e.getStaffList(),e.company=r.formatCompany(o.appUser,e.company),e.canAdd=(!0===e.company.isCompanyAdmin||!0===o.appUser.is_admin)&&!1===e.upperLimit,!0===e.canAdd&&e.genQRCode()},n=function(e,n){return{restrict:"A",scope:{appUser:"<",company:"<"},link:function(a,i,o){i.on("click",function(){console.log("in:",a.company),n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.rootDir.views+"staff/staffDetailsEdit.html",controller:["$uibModalInstance","staff","company","CompanyService","$rootScope","UtilsService",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{staff:function(){return a.staff},company:function(){return a.company}}})})}}};angular.module("shmApp.directives").directive("staffListNewItemBtn",["appConf","$uibModal",n])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",company:"<",pageSize:"<?"},templateUrl:e.rootDir.views+"notification/notificationList.html",link:function(e,n,a){e.pageSize=e.pageSize?e.pageSize:3,e.getNotifications=function(n){var a={page:n||1};a.page>1?e.gettingMore=!0:e.getting=!0,e.gettingErr=void 0,e.gettingMoreErr=void 0,t.getCompanyComments(e.company.id,{"page-size":e.pageSize,page:a.page}).then(function(t){e.itemList&&e.itemList.data&&a.page>1?(a.previousData=e.itemList.data,e.itemList=t.data,e.itemList.data=a.previousData.concat(e.itemList.data)):e.itemList=t.data},function(t){a.page>1?e.gettingMoreErr=t.data:e.gettingErr=t.data}).finally(function(){e.getting=void 0,e.gettingMore=void 0})},e.addedNewNotification=function(t){e.itemList.data.unshift(t),e.itemList.total=1*e.itemList.total+1},e.getNotifications()}}};angular.module("shmApp.directives").directive("notificationList",["appConf","CompanyService",e])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.company=n,r.cancel=function(){e.dismiss("cancel")},r.save=function(){r.creating=!0,r.creatingErr=void 0,a.addCommentToAnCompany(r.company.id,{comments:r.message}).then(function(t){e.close(t.data),i.success(o.instant("NOTIFICATION.CREATED_SUCCESSFULLY"))},function(e){r.creatingErr=e.data}).finally(function(){r.creating=void 0})}},t=function(t,n,a){return{restrict:"A",scope:{appUser:"<",company:"<",succFunc:"&?"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"notification/notificationCreatePopupPanel.html",controller:["$uibModalInstance","appUser","company","CompanyService","toastr","$translate",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},company:function(){return a.company}}}).result.then(function(e){"function"==typeof a.succFunc&&"function"==typeof a.succFunc()&&a.succFunc()(e)})})}}};angular.module("shmApp.directives").directive("notificationCreatePopupBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.appUser=t,i.company=n,i.notification=a,i.cancel=function(){e.dismiss("cancel")}},t=function(t,n){return{restrict:"A",scope:{appUser:"<",company:"<",notification:"<"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"notification/NotificationDetailsPopupPanel.html",controller:["$uibModalInstance","appUser","company","notification",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},company:function(){return a.company},notification:function(){return a.notification}}}).result.then(function(e){!0===e&&(a.staff.active=0)})})}}};angular.module("shmApp.directives").directive("notificationDetailsPopupBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",transclude:!0,scope:{appUser:"<?"},templateUrl:e.rootDir.views+"user/logoutBtn.html",link:function(e,i,o){e.logout=function(){t.logout(),n.go("login",{},{reload:!0}),a.appUser=void 0}}}};angular.module("shmApp.directives").directive("logoutBtn",["appConf","AuthService","$state","$rootScope",e])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{user:"<?"},templateUrl:e.rootDir.views+"user/userAvatar.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("userAvatar",["appConf",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{appUser:"<",item:"<",selectMode:"<?",selectedItem:"=?"},templateUrl:e.rootDir.views+"voucher/voucherGridItem.html",link:function(e,t,n){e.changeList=function(){e.selectedItem&&e.selectedItem.entity_id===e.item.id?e.selectedItem=void 0:e.selectedItem={entity_name:"App\\Modules\\Platform\\Models\\CompanyVoucherGroup",entity_id:e.item.id,entity:e.item}},e.maxOwnerShowing=4}}};angular.module("shmApp.directives").directive("voucherGridItem",["appConf","ItemService",e])}(),function(){"use strict";var e={available:1,expired:2,deleted:3,all:void 0},t=function(t,n,a,i){return{restrict:"AE",scope:{appUser:"<",company:"<"},templateUrl:t.rootDir.views+"voucher/voucherList.html",link:function(t,o,r){t.pageSize=t.pageSize?t.pageSize:12,t.searchTypes=e,t.type=e.available,t.searchObject={text:""},t._getItems=function(e,i){var o={page:e};n.displayCounts="",t.gettingErr=void 0,t.gettingMoreErr=void 0,o.page>1?t.gettingMore=!0:t.getting=!0,a.getVoucherGroupsUnderCompany(t.company.id,i).then(function(e){t.itemList&&t.itemList.data&&t.itemList.data.length>0&&o.page>1?(o.previousData=t.itemList.data,t.itemList=e.data,t.itemList.data=o.previousData.concat(e.data.data)):t.itemList=e.data,n.displayCounts=e.data.to?e.data.to+"/"+e.data.total:""},function(e){o.page>1?t.gettingMoreErr=e.data:t.gettingErr=e.data}).finally(function(){t.getting=void 0,t.gettingMore=void 0})},t.switchType=function(e){t.type=e,t.getItems()},t.navigateTo=function(e){i.go(e,{},{reload:!0})},t.getItems=function(n){var a={page:n||1};switch(a.params={"page-size":t.pageSize,page:a.page},t.searchObject&&t.searchObject.text&&""!=t.searchObject.text&&(a.params["key-word"]=t.searchObject.text),t.type){case e.available:a.params.available=1;break;case e.expired:a.params.unavailable=1;break;case e.deleted:a.params.deleted=1}t._getItems(n,a.params)},t.getItems()}}};angular.module("shmApp.directives").directive("voucherList",["appConf","$rootScope","CompanyService","$state",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){return{restrict:"AE",scope:{appUser:"<",company:"<",voucherId:"<?",cancelFunc:"&?"},templateUrl:e.rootDir.views+"voucher/voucherDetails.html",link:function(e,r,s){e.getVoucherGroup=function(n){e.gettingVoucher=!0,t.getVoucherGroupById(e.voucherId).then(function(t){e.voucherGroup=t.data,e.voucherGroup.end_date=moment(moment.utc(e.voucherGroup.end_date)).local().format("YYYY-MM-DD HH:mm"),a.editingVoucher=e.voucherGroup,"function"==typeof n&&n(e.voucherGroup)},function(t){e.gettingVoucherError=t.data}).finally(function(){e.gettingVoucher=!1})},e.startDateBeforeRender=function(e){var t=new Date,n=new Date(t);n.setDate(t.getDate()+1),n.setUTCHours(0,0,0,0),e.filter(function(e){return e.utcDateValue<n.getTime()}).forEach(function(e){e.selectable=!1})},e.cancel=function(){!0===e.hasCancelFunc&&e.cancelFunc()()},e.voucherSaved=function(e){o.go("backend.vouchers_details",{voucherGroupId:e.id},{reload:!0})},e.formatVoucher=function(t){return t.reedm_desc&&""!==t.reedm_desc||(t.reedm_desc=e.company.config&&e.company.config.defaultRedeemDesc?e.company.config.defaultRedeemDesc:""),t},e.getPreSaveCheckErr=function(){e.savingError={};var t={validObj:[]};if(e.voucherGroup.title&&""!==e.voucherGroup.title||(e.savingError.title=n.instant("VOUCHER.ERROR.TITLE.REQUIRED"),t.validObj.push(e.savingError.title)),e.voucherGroup.quantity&&""!==e.voucherGroup.quantity||(e.savingError.quantity=n.instant("VOUCHER.ERROR.QUANTITY.REQUIRED"),t.validObj.push(e.savingError.quantity)),e.voucherGroup.end_date&&""!==e.voucherGroup.end_date||(e.savingError.end_date=n.instant("VOUCHER.ERROR.EXPIRE_DATE.REQUIRED"),t.validObj.push(e.savingError.end_date)),e.voucherGroup.reedm_desc&&""!==e.voucherGroup.reedm_desc||(e.savingError.reedm_desc=n.instant("VOUCHER.ERROR.REDEEM.REQUIRED"),t.validObj.push(e.savingError.reedm_desc)),t.validObj.length>0)return i.getErrorMsgObj("",{"":t.validObj})},e.hasCancelFunc="function"==typeof e.cancelFunc&&"function"==typeof e.cancelFunc(),e.company=i.formatCompany(e.appUser,e.company),e.voucherId?e.getVoucherGroup(function(t){e.canEdit=!0===e.company.isCompanyAdmin&&""!==t.id||!0===e.appUser.is_admin,e.voucherGroup=e.formatVoucher(t)}):(e.canEdit=!0===e.company.isCompanyAdmin&&!0!==e.company.is_expired||!0===e.appUser.is_admin,e.voucherGroup=e.formatVoucher({company_id:e.company.id}),e.gettingVoucher=!1)}}};angular.module("shmApp.directives").directive("voucherDetails",["appConf","CompanyService","$translate","$rootScope","UtilsService","$state",e])}(),function(){"use strict";var e=function(e,t,n,a){var i=this;i.appUser=t,i.voucher=n,i.cancel=function(){e.dismiss("cancel")},i.getQrCodes=function(){i.totalQrCodes=0,i.getting=!0,i.gettingErr=void 0,a.genVoucherQrCode(i.voucher.id).then(function(e){i.qrcodes=e.data,angular.forEach(i.qrcodes,function(e,t){e&&null!==e&&""!==e?i.totalQrCodes=1*i.totalQrCodes+1:delete i.qrcodes[t]})},function(e){i.gettingErr=e.data}).finally(function(){i.getting=void 0})},i.getQrCodes()},t=function(t,n){return{restrict:"AE",scope:{appUser:"<",voucher:"<"},link:function(a,i,o){i.on("click",function(){n.open({animation:!0,templateUrl:t.rootDir.views+"voucher/voucherQrCodePanel.html",controller:["$uibModalInstance","appUser","voucher","CompanyService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return a.appUser},voucher:function(){return a.voucher}}})})}}};angular.module("shmApp.directives").directive("voucherGroupQrCodePopupBtn",["appConf","$uibModal",t])}(),function(){"use strict";var e=function(e,t,n,a,i,o){var r=this;r.appUser=t,r.company=n,r.voucher=a,r.preCheckingErr=i,r.cancel=function(){e.dismiss("cancel")},r.save=function(){var t={};t.voucherData=angular.copy(r.voucher),t.voucherData.end_date=moment(moment(r.voucher.end_date)).utc().format("YYYY-MM-DD HH:mm:ss"),t.voucherData.voucher_img=t.voucherData.images[0]?t.voucherData.images[0]:"",t.savingFunc=r.voucher.id&&""!==r.voucher.id?o.updateCompanyVoucherGroup(r.voucher.id,t.voucherData):o.createCompanyVoucherGroup(t.voucherData),r.saving=!0,r.savingErr=void 0,t.savingFunc.then(function(t){r.voucher=t.data,e.close(r.voucher)},function(e){r.savingErr=e.data}).finally(function(){r.saving=void 0})}},t=function(t,n,a,i){return{restrict:"A",scope:{appUser:"<",company:"<",voucherSaveBtn:"=",succFunc:"&?",getPreCheckErrFunc:"&?"},link:function(o,r,s){r.on("click",function(){o.voucher=o.voucherSaveBtn,n.open({animation:!0,templateUrl:t.rootDir.views+"voucher/confirmSave.html",controller:["$uibModalInstance","appUser","company","voucher","preCheckingErr","CompanyService",e],controllerAs:"mdCtrl",resolve:{appUser:function(){return o.appUser},company:function(){return o.company},voucher:function(){return o.voucher},preCheckingErr:function(){if("function"==typeof o.getPreCheckErrFunc&&"function"==typeof o.getPreCheckErrFunc())return o.getPreCheckErrFunc()(o.voucher)}}}).result.then(function(e){o.voucher.id&&""!==o.voucher.id?a.success(i.instant("ITEM.UPDATE.SUCCESSFULLY")):a.success(i.instant("ITEM.CREATE.SUCCESSFULLY")),"function"==typeof o.succFunc&&"function"==typeof o.succFunc()&&o.succFunc()(e)})})}}};angular.module("shmApp.directives").directive("voucherSaveBtn",["appConf","$uibModal","toastr","$translate",t])}(),function(){"use strict";var e,t=function(t,n){e=this,e.customerServiceQrcodes=[n.rootDir.images+"kefu_new_1.png",n.rootDir.images+"kefu_new_4.png"],e.cancel=function(){t.dismiss("cancel")}},n=function(e,n,a){return{restrict:"AE",scope:{title:"@?",btnText:"@?"},template:'<div class="ask-customer-service-panel-wrapper text-center"><div class="panel-title" ng-if="title != \'\'">{{title}}</div><div class="panel-body"><button type="button" class="btn btn-info" ng-click="showContacts()" title="{{\'CUSTOMER_SERVICE.CLICK_HERE_TO_SHOW_CONTACTS\' | translate}}"><i class="fa fa-link"></i> <span>{{btnText}}</span></button></div></div>',link:function(e,i,o){e.showContacts=function(){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:'<div class="customer-service-contacts-wrapper"><div class="modal-header"><span class="panel-title" translate="CUSTOMER_SERVICE.MODAL.TITLE"></span></div><div class="modal-body"><div class="row customer-service-qr-code-wrapper"><div class="customer-service-qr-code col-md-6 text-center" ng-repeat="img in mdCtrl.customerServiceQrcodes"><img ng-src="{{img}}" class="img-responsive"/></div></div></div><div class="modal-footer text-center"><button type="button" class="btn btn-success" translate="OK" ng-click="mdCtrl.cancel()"></button></div></div>',controller:["$uibModalInstance","appConf",t],controllerAs:"mdCtrl",size:void 0,appendTo:void 0})},e.btnText=e.btnText||a.instant("CLICK_HERE_TO_SHOW_CUSTOMER_CONTACTS")}}};angular.module("shmApp.directives").directive("askCustomerServicePanel",["$rootScope","$uibModal","$translate",n])}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{},template:'<div class="count-to">{{displayingNumber}}</div>',link:function(t,n,a){t.update=function(){t.displayingNumber>=t.maxNumber?e.cancel(t.updater):t.displayingNumber=1*t.displayingNumber+1},t.displayingNumber=0,t.maxNumber=a.countTo,t.updater=e(t.update,Math.floor(900/t.maxNumber))}}};angular.module("shmApp.directives").directive("countTo",["$interval",e])}(),function(){"use strict";var e=function(e,t){return{restrict:"A",scope:{addressObj:"="},link:function(n,a,i){n.addressObj&&(n.addressGoogleObject=t.buildGooglePlacesResult(n.addressObj),a.val(n.addressGoogleObject.formatted_address)),e.then(function(){var e={};e.searchBox=new google.maps.places.SearchBox(a[0]),e.searchBox.addListener("places_changed",function(){e.places=e.searchBox.getPlaces(),n.addressObj=t.mapGoogleMapToAddressObj(e.places[0])})},function(){})}}};angular.module("shmApp.directives").directive("googlePlacesAutoComplete",["loadGoogleMapLib","UtilsService",e])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{},template:'<div class="text-center"><div class="fa fa-spinner fa-spin fa-3x"></div></div>'}};angular.module("shmApp.directives").directive("loadingBar",e)}(),function(){"use strict";var e=function(e,t){return{restrict:"AE",scope:{},template:'<div class="opened-in-wechat-wrapper text-center" ng-if="openedInWechat === true"><div class="icon"><i class="fa fa-warning"></i></div><div translate="OPENED_IN_WECHAT_PLEASE_OPEN_IN_BROWSER"></div><div>{{url}}</div></div>',link:function(n,a,i){n.openedInWechat=t.openedInWeChat()||t.openInWindowsWechat(),e.openedInWechat=n.openedInWechat,n.url=window.location.href}}};angular.module("shmApp.directives").directive("openedInWeChatChecker",["$rootScope","WeChatService",e])}(),function(){"use strict";var e=function(e){return{restrict:"A",scope:{scrollingElementId:"@?"},template:"",link:function(t,n,a){t.offsetTop=angular.element(n).prop("offsetTop"),t.topClass=a.setClassWhenAtTop,t.listeningElement=t.scrollingElementId?angular.element("#"+t.scrollingElementId):angular.element(e),t.listeningElement.on("scroll",function(a){e.pageYOffset>=t.offsetTop?n.addClass(t.topClass):(n.removeClass(t.topClass),n.css({width:"auto"}))})}}};angular.module("shmApp.directives").directive("setClassWhenAtTop",["$window",e])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{errorObj:"<",msgOnly:"<?",hideCloseBtn:"<?"},template:"<div class='alert alert-danger text-left' ng-if='errorObj'><a href='#' class='close' data-dismiss='alert' aria-label='close' ng-hide='hideCloseBtn === true'>&times;</a><strong>{{ errorObj.message }}</strong><ul ng-if='errorObj.errors && msgOnly !== true'><li ng-repeat='(field, errorMsgs) in errorObj.errors'><span class='field'>{{ field }}</span><ul><li ng-repeat='errorMsg in errorMsgs'>{{ errorMsg }}</li></ul></li></ul></div>",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("showErrorFromJson",["appConf",t])}(),function(){"use strict";var e=function(e,t){e.editor.addButton("imagelink",{icon:"image",tooltip:t.instant("INSERT_IMAGE"),onclick:function(){e.showOptions(),e.$apply()}}),e.editor.addButton("fullscreen",{icon:"fullscreen",tooltip:t.instant("FULL_SCREEN"),onclick:function(){var t={};t.state=this.active(),t.state?angular.element(e.editor.editorContainer).removeClass("mce-fullscreen"):angular.element(e.editor.editorContainer).addClass("mce-fullscreen"),this.active(!t.state)}}),e.editor.on("Change",function(t){e.text=e.editor.getContent()})},t=function(t,n){return{restrict:"E",scope:{text:"=ngModel",height:"@?"},templateUrl:t.rootDir.views+"textEditor.html",link:function(t,a,i){t.newAssets={images:[]},t.hideOptions=function(){t.showingOptions=!1},t.showOptions=function(){t.showingOptions=!0},t.insertAssets=function(e){angular.forEach(e,function(e){t.editor.insertContent('<div class="admin-page-uploaded-img-wrapper"><img src="'+e.url+'" style="width: 100%"/></div>')}),t.hideOptions()},t.tinymceOptions={menubar:!1,plugins:"textcolor colorpicker lists",toolbar:["undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | forecolor backcolor | imagelink | fullscreen"],preview_styles:"font-size color background-color",object_resizing:!1,branding:!1,height:t.height||"100vh",setup:function(a){t.editor=a,e(t,n)}}}}};angular.module("shmApp.directives").directive("textEditor",["appConf","$translate",t])}(),function(){"use strict";var e=function(e,t,n,a){return{restrict:"AE",scope:{maxNoOfImages:"@?",assets:"=",postSuccFunc:"&?",emptyAfterSucc:"<?",btnText:"@?",ngDisabled:"<?"},templateUrl:e.rootDir.views+"uploadImg.html",link:function(e,t,i){e.signAssetsBack=function(){!0===e.srcIsArray?e.assets=angular.copy(e.aCopyOfAssets):!0===angular.isArray(e.aCopyOfAssets)&&e.aCopyOfAssets.length>0?e.assets=e.aCopyOfAssets[0]:e.assets={}},e.deleteAsset=function(t){var n={};angular.forEach(e.aCopyOfAssets,function(e,a){e.id===t.id&&(n.index=a)}),n.index>-1&&e.aCopyOfAssets.splice(n.index,1),e.signAssetsBack()},e.upload=function(t){t=t.slice(0,e.maxNoOfImages>=e.aCopyOfAssets.length?e.maxNoOfImages-e.aCopyOfAssets.length:0);var a=t.length;angular.forEach(t,function(t,i){var o={};if(o.arrayIndex=e.aCopyOfAssets.length,e.aCopyOfAssets.push({preProcessing:{uploading:!0,uploadingErr:void 0,originalFile:t}}),t.size/1e6>20)return void(e.aCopyOfAssets[o.arrayIndex].uploadingImgErr={message:$translate.instant("ITEM.PAGE.CREATE.VIDEO.OVER_SIZE",{size:"20MB"}),errors:{}});n.imgResize(t).then(function(t){n.uploadAsset(t).then(function(t){e.aCopyOfAssets[o.arrayIndex]=t.data,1*i+1===a&&(e.signAssetsBack(),"function"==typeof e.postSuccFunc&&"function"==typeof e.postSuccFunc()&&e.postSuccFunc()(e.aCopyOfAssets),!0===e.emptyAfterSucc&&(e.assets=void 0,e.init()))},function(t){e.aCopyOfAssets[o.arrayIndex].preProcessing.uploadingErr=t.data}).finally(function(){})})})},e.init=function(){void 0===e.assets&&(1===e.maxNoOfImages?e.assets={}:e.assets=[]),e.srcIsArray=!1,e.aCopyOfAssets=angular.copy(e.assets),e.aCopyOfAssets&&(e.srcIsArray=angular.isArray(e.aCopyOfAssets),!0!==e.srcIsArray&&(e.aCopyOfAssets=[e.aCopyOfAssets])),!1===e.srcIsArray&&(e.maxNoOfImages=1)},e.maxNoOfImages=e.maxNoOfImages||1,e.maxFileSize="20MB",e.btnText=e.btnText||a.instant("UPLOAD_IMAGE.BTN.TITLE"),e.init()}}};angular.module("shmApp.directives").directive("uploadImg",["appConf","Upload","AssetService","$translate",e])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{data:"=ngModel",tags:"<"},template:'<div><tags-input ng-model="data" placeholder="{{\'COMPANY_TAGS.PLACEHOLDER\' | translate}}" allow-leftover-text="true" use-strings="true" add-on-space="true" min-length="1" class="tags-input">\n    <auto-complete source="tags"\n                   min-length="0"\n                   load-on-focus="true"\n                   load-on-empty="true"\n                   max-results-to-show="500"></auto-complete>\n</tags-input></div>'}};angular.module("shmApp.directives").directive("tagInput",[e])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{data:"=ngModel",title:"<",inputId:"<"},template:'<div class="numInput"><div class="input-group pull-right"><div class="input-group-btn"><button type="button" class="btn btn-default btn-sm"ng-if="data >= 1" ng-click="minus()"><i class="fa fa-minus"></i></button></div><input class="form-control" name="{{title}}" min="0" ng-model="data" type="number" save="" oninput="validity.valid ? this.save = value : value = this.save;" placeholder="{{ \'SUPER_ADMIN.ITEM_ADD_JIELONG_MODAL.RESERVE.NO.LIMIT\' | translate }}"/><div class="input-group-btn"><button type="button" class="btn btn-success btn-sm"ng-click="add()"><i class = "fa fa-plus"></i></button></div></div></div>',link:function(e,t,n){e.minus=function(){e.data=e.data-1==0?"":e.data-1},e.add=function(){e.data=e.data?e.data+1:1}}}};angular.module("shmApp.directives").directive("inputNumber",e)}(),function(){"use strict";var e=function(e){return function(t){var n={};return n.parts=e("number")(t).split(","),1===n.parts.length?t:2===n.parts.length?(t/1e3).toFixed(1)+"K":3===n.parts.length?(t/1e6).toFixed(1)+"M":void 0}};angular.module("shmApp.filters").filter("shortNumber",["$filter",e])}(),function(){"use strict";var e=function(e){return function(t){return e.trustAsHtml(t)}};angular.module("shmApp.filters").filter("trustAsHtml",["$sce",e])}();